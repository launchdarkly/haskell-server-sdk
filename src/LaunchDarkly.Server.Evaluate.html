<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">LaunchDarkly.Server.Evaluate</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(%~)</span></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">msum</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mzero</span></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">firstJustM</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Crypto.Hash.SHA1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hash</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Value</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Base16</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B16</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromLeft</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&amp;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Generics.Product</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">field</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getField</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HashSet</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HS</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">genericIndex</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromJust</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isJust</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Scientific</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Scientific</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">floatingOrInteger</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">encodeUtf8</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word8</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Natural</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Natural</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapRight</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldlM</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">firstJust</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Client.Internal.html"><span class="hs-identifier">LaunchDarkly.Server.Client.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Client.Internal.html#Client"><span class="hs-identifier">Client</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Client.Status.html#Status"><span class="hs-identifier">Status</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Client.Status.html#Initialized"><span class="hs-identifier">Initialized</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Client.Internal.html#getStatusI"><span class="hs-identifier">getStatusI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.html"><span class="hs-identifier">LaunchDarkly.Server.Context</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Context.html#getIndividualContext"><span class="hs-identifier">getIndividualContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.html#getValueForReference"><span class="hs-identifier">getValueForReference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html"><span class="hs-identifier">LaunchDarkly.Server.Context.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier">Context</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Invalid"><span class="hs-identifier">Invalid</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#getKey"><span class="hs-identifier">getKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#getKinds"><span class="hs-identifier">getKinds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html"><span class="hs-identifier">LaunchDarkly.Server.Details</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvalErrorKind"><span class="hs-identifier">EvalErrorKind</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier">EvaluationDetail</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationReason"><span class="hs-identifier">EvaluationReason</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Events.html"><span class="hs-identifier">LaunchDarkly.Server.Events</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Events.html#EvalEvent"><span class="hs-identifier">EvalEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Events.html#newSuccessfulEvalEvent"><span class="hs-identifier">newSuccessfulEvalEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Events.html#newUnknownFlagEvent"><span class="hs-identifier">newUnknownFlagEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Events.html#processEvalEvents"><span class="hs-identifier">processEvalEvents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html"><span class="hs-identifier">LaunchDarkly.Server.Features</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Clause"><span class="hs-identifier">Clause</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier">Flag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Prerequisite"><span class="hs-identifier">Prerequisite</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#RolloutKind"><span class="hs-identifier">RolloutKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Features.html#RolloutKindExperiment"><span class="hs-identifier">RolloutKindExperiment</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Rule"><span class="hs-identifier">Rule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Segment"><span class="hs-identifier">Segment</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#SegmentRule"><span class="hs-identifier">SegmentRule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#SegmentTarget"><span class="hs-identifier">SegmentTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Target"><span class="hs-identifier">Target</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#VariationOrRollout"><span class="hs-identifier">VariationOrRollout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Operators.html"><span class="hs-identifier">LaunchDarkly.Server.Operators</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Operators.html#Op"><span class="hs-identifier">Op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Operators.html#OpSegmentMatch"><span class="hs-identifier">OpSegmentMatch</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Operators.html#getOperation"><span class="hs-identifier">getOperation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Reference.html"><span class="hs-identifier">LaunchDarkly.Server.Reference</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Reference.html#getComponents"><span class="hs-identifier">getComponents</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Reference.html#getError"><span class="hs-identifier">getError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Reference.html#isValid"><span class="hs-identifier">isValid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Reference.html#makeLiteral"><span class="hs-identifier">makeLiteral</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Reference.html#makeReference"><span class="hs-identifier">makeReference</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html"><span class="hs-identifier">LaunchDarkly.Server.Store.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier">LaunchDarklyStoreRead</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#getFlagC"><span class="hs-identifier">getFlagC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#getSegmentC"><span class="hs-identifier">getSegmentC</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Util.html"><span class="hs-identifier">LaunchDarkly.Server.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Util.html#fst3"><span class="hs-identifier">fst3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Util.html#snd3"><span class="hs-identifier">snd3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Util.html#trd"><span class="hs-identifier">trd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#setFallback"><span class="hs-identifier hs-type">setFallback</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-43"></span><span id="setFallback"><span class="annot"><span class="annottext">setFallback :: EvaluationDetail Value -&gt; Value -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#setFallback"><span class="hs-identifier hs-var hs-var">setFallback</span></a></span></span><span> </span><span id="local-6989586621679674015"><span class="annot"><span class="annottext">detail :: EvaluationDetail Value
</span><a href="#local-6989586621679674015"><span class="hs-identifier hs-var">detail</span></a></span></span><span> </span><span id="local-6989586621679674014"><span class="annot"><span class="annottext">fallback :: Value
</span><a href="#local-6989586621679674014"><span class="hs-identifier hs-var">fallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Maybe Integer
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;variationIndex&quot;</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679674015"><span class="hs-identifier hs-var">detail</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679674015"><span class="hs-identifier hs-var">detail</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:value:EvaluationDetail :: Value
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3Avalue%3AEvaluationDetail"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679674014"><span class="hs-identifier hs-var">fallback</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679674015"><span class="hs-identifier hs-var">detail</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span id="local-6989586621679674251"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#setValue"><span class="hs-identifier hs-type">setValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674251"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674251"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-48"></span><span id="setValue"><span class="annot"><span class="annottext">setValue :: EvaluationDetail Value -&gt; a -&gt; EvaluationDetail a
</span><a href="LaunchDarkly.Server.Evaluate.html#setValue"><span class="hs-identifier hs-var hs-var">setValue</span></a></span></span><span> </span><span id="local-6989586621679674011"><span class="annot"><span class="annottext">x :: EvaluationDetail Value
</span><a href="#local-6989586621679674011"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679674010"><span class="annot"><span class="annottext">v :: a
</span><a href="#local-6989586621679674010"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679674011"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:value:EvaluationDetail :: a
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3Avalue%3AEvaluationDetail"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679674010"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#isError"><span class="hs-identifier hs-type">isError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationReason"><span class="hs-identifier hs-type">EvaluationReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-51"></span><span id="isError"><span class="annot"><span class="annottext">isError :: EvaluationReason -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#isError"><span class="hs-identifier hs-var hs-var">isError</span></a></span></span><span> </span><span id="local-6989586621679674008"><span class="annot"><span class="annottext">reason :: EvaluationReason
</span><a href="#local-6989586621679674008"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EvaluationReason
</span><a href="#local-6989586621679674008"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationReasonError"><span class="hs-identifier hs-type">EvaluationReasonError</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span id="local-6989586621679674006"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#evaluateTyped"><span class="hs-identifier hs-type">evaluateTyped</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Client.Internal.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674006"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679674006"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679674006"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674006"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-54"></span><span id="evaluateTyped"><span class="annot"><span class="annottext">evaluateTyped :: Client
-&gt; Text
-&gt; Context
-&gt; a
-&gt; (a -&gt; Value)
-&gt; Bool
-&gt; (Value -&gt; Maybe a)
-&gt; IO (EvaluationDetail a)
</span><a href="LaunchDarkly.Server.Evaluate.html#evaluateTyped"><span class="hs-identifier hs-var hs-var">evaluateTyped</span></a></span></span><span> </span><span id="local-6989586621679674004"><span class="annot"><span class="annottext">client :: Client
</span><a href="#local-6989586621679674004"><span class="hs-identifier hs-var">client</span></a></span></span><span> </span><span id="local-6989586621679674003"><span class="annot"><span class="annottext">key :: Text
</span><a href="#local-6989586621679674003"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span id="local-6989586621679674002"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679674002"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679674001"><span class="annot"><span class="annottext">fallback :: a
</span><a href="#local-6989586621679674001"><span class="hs-identifier hs-var">fallback</span></a></span></span><span> </span><span id="local-6989586621679674000"><span class="annot"><span class="annottext">wrap :: a -&gt; Value
</span><a href="#local-6989586621679674000"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span id="local-6989586621679673999"><span class="annot"><span class="annottext">includeReason :: Bool
</span><a href="#local-6989586621679673999"><span class="hs-identifier hs-var">includeReason</span></a></span></span><span> </span><span id="local-6989586621679673998"><span class="annot"><span class="annottext">convert :: Value -&gt; Maybe a
</span><a href="#local-6989586621679673998"><span class="hs-identifier hs-var">convert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="annottext">Client -&gt; IO Status
</span><a href="LaunchDarkly.Server.Client.Internal.html#getStatusI"><span class="hs-identifier hs-var">getStatusI</span></a></span><span> </span><span class="annot"><span class="annottext">Client
</span><a href="#local-6989586621679674004"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="annot"><span class="annottext">IO Status
-&gt; (Status -&gt; IO (EvaluationDetail a)) -&gt; IO (EvaluationDetail a)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679673997"><span class="annot"><span class="annottext">status :: Status
</span><a href="#local-6989586621679673997"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-56"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="#local-6989586621679673997"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="annot"><span class="annottext">Status -&gt; Status -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="LaunchDarkly.Server.Client.Status.html#Initialized"><span class="hs-identifier hs-var">Initialized</span></a></span><span>
</span><span id="line-57"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">EvaluationDetail a -&gt; IO (EvaluationDetail a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail a -&gt; IO (EvaluationDetail a))
-&gt; EvaluationDetail a -&gt; IO (EvaluationDetail a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe Integer -&gt; EvaluationReason -&gt; EvaluationDetail a
forall value.
value
-&gt; Maybe Integer -&gt; EvaluationReason -&gt; EvaluationDetail value
</span><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-var">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679674001"><span class="hs-identifier hs-var">fallback</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Integer
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(EvaluationReason -&gt; EvaluationDetail a)
-&gt; EvaluationReason -&gt; EvaluationDetail a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonError"><span class="hs-identifier hs-var">EvaluationReasonError</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorClientNotReady"><span class="hs-identifier hs-var">EvalErrorClientNotReady</span></a></span><span>
</span><span id="line-58"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-59"></span><span>                </span><span class="annot"><span class="annottext">Client
-&gt; Text
-&gt; Context
-&gt; Value
-&gt; Bool
-&gt; IO (EvaluationDetail Value, Maybe [Text])
</span><a href="LaunchDarkly.Server.Evaluate.html#evaluateInternalClient"><span class="hs-identifier hs-var">evaluateInternalClient</span></a></span><span> </span><span class="annot"><span class="annottext">Client
</span><a href="#local-6989586621679674004"><span class="hs-identifier hs-var">client</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679674003"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679674002"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Value
</span><a href="#local-6989586621679674000"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679674001"><span class="hs-identifier hs-var">fallback</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679673999"><span class="hs-identifier hs-var">includeReason</span></a></span><span> </span><span class="annot"><span class="annottext">IO (EvaluationDetail Value, Maybe [Text])
-&gt; ((EvaluationDetail Value, Maybe [Text])
    -&gt; IO (EvaluationDetail a))
-&gt; IO (EvaluationDetail a)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679673992"><span class="annot"><span class="annottext">detail :: EvaluationDetail Value
</span><a href="#local-6989586621679673992"><span class="hs-identifier hs-var">detail</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-60"></span><span>                    </span><span class="annot"><span class="annottext">EvaluationDetail a -&gt; IO (EvaluationDetail a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail a -&gt; IO (EvaluationDetail a))
-&gt; EvaluationDetail a -&gt; IO (EvaluationDetail a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-61"></span><span>                        </span><span class="annot"><span class="annottext">EvaluationDetail a
-&gt; (a -&gt; EvaluationDetail a) -&gt; Maybe a -&gt; EvaluationDetail a
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-62"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe Integer -&gt; EvaluationReason -&gt; EvaluationDetail a
forall value.
value
-&gt; Maybe Integer -&gt; EvaluationReason -&gt; EvaluationDetail value
</span><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-var">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679674001"><span class="hs-identifier hs-var">fallback</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Integer
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(EvaluationReason -&gt; EvaluationDetail a)
-&gt; EvaluationReason -&gt; EvaluationDetail a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">EvaluationReason -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#isError"><span class="hs-identifier hs-var">isError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; EvaluationReason
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;reason&quot;</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673992"><span class="hs-identifier hs-var">detail</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; EvaluationReason
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;reason&quot;</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673992"><span class="hs-identifier hs-var">detail</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonError"><span class="hs-identifier hs-var">EvaluationReasonError</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorWrongType"><span class="hs-identifier hs-var">EvalErrorWrongType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; a -&gt; EvaluationDetail a
forall a. EvaluationDetail Value -&gt; a -&gt; EvaluationDetail a
</span><a href="LaunchDarkly.Server.Evaluate.html#setValue"><span class="hs-identifier hs-var">setValue</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673992"><span class="hs-identifier hs-var">detail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Maybe a
</span><a href="#local-6989586621679673998"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Maybe a) -&gt; Value -&gt; Maybe a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Value
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;value&quot;</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673992"><span class="hs-identifier hs-var">detail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#evaluateInternalClient"><span class="hs-identifier hs-type">evaluateInternalClient</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Client.Internal.html#Client"><span class="hs-identifier hs-type">Client</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span id="evaluateInternalClient"><span class="annot"><span class="annottext">evaluateInternalClient :: Client
-&gt; Text
-&gt; Context
-&gt; Value
-&gt; Bool
-&gt; IO (EvaluationDetail Value, Maybe [Text])
</span><a href="LaunchDarkly.Server.Evaluate.html#evaluateInternalClient"><span class="hs-identifier hs-var hs-var">evaluateInternalClient</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Invalid"><span class="hs-identifier hs-type">Invalid</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679673989"><span class="annot"><span class="annottext">fallback :: Value
</span><a href="#local-6989586621679673989"><span class="hs-identifier hs-var">fallback</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail Value, Maybe [Text])
-&gt; IO (EvaluationDetail Value, Maybe [Text])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((EvaluationDetail Value, Maybe [Text])
 -&gt; IO (EvaluationDetail Value, Maybe [Text]))
-&gt; (EvaluationDetail Value, Maybe [Text])
-&gt; IO (EvaluationDetail Value, Maybe [Text])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvalErrorKind -&gt; Value -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#errorDefault"><span class="hs-identifier hs-var">errorDefault</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorInvalidContext"><span class="hs-identifier hs-var">EvalErrorInvalidContext</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679673989"><span class="hs-identifier hs-var">fallback</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#evaluateInternalClient"><span class="hs-identifier hs-var">evaluateInternalClient</span></a></span><span> </span><span id="local-6989586621679673986"><span class="annot"><span class="annottext">client :: Client
</span><a href="#local-6989586621679673986"><span class="hs-identifier hs-var">client</span></a></span></span><span> </span><span id="local-6989586621679673985"><span class="annot"><span class="annottext">key :: Text
</span><a href="#local-6989586621679673985"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span id="local-6989586621679673984"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673984"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673983"><span class="annot"><span class="annottext">fallback :: Value
</span><a href="#local-6989586621679673983"><span class="hs-identifier hs-var">fallback</span></a></span></span><span> </span><span id="local-6989586621679673982"><span class="annot"><span class="annottext">includeReason :: Bool
</span><a href="#local-6989586621679673982"><span class="hs-identifier hs-var">includeReason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679673981"><span class="annot"><span class="annottext">detail :: EvaluationDetail Value
</span><a href="#local-6989586621679673981"><span class="hs-identifier hs-var">detail</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673980"><span class="annot"><span class="annottext">unknown :: Bool
</span><a href="#local-6989586621679673980"><span class="hs-identifier hs-var">unknown</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673979"><span class="annot"><span class="annottext">events :: [EvalEvent]
</span><a href="#local-6989586621679673979"><span class="hs-identifier hs-var">events</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673978"><span class="annot"><span class="annottext">prereqs :: Maybe [Text]
</span><a href="#local-6989586621679673978"><span class="hs-identifier hs-var">prereqs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-70"></span><span>        </span><span class="annot"><span class="annottext">StoreHandle IO -&gt; Text -&gt; StoreResultM IO (Maybe Flag)
forall store (m :: * -&gt; *).
LaunchDarklyStoreRead store m =&gt;
store -&gt; Text -&gt; StoreResultM m (Maybe Flag)
</span><a href="LaunchDarkly.Server.Store.Internal.html#getFlagC"><span class="hs-identifier hs-var">getFlagC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Client -&gt; StoreHandle IO
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;store&quot;</span></span><span> </span><span class="annot"><span class="annottext">Client
</span><a href="#local-6989586621679673986"><span class="hs-identifier hs-var">client</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673985"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">StoreResultM IO (Maybe Flag)
-&gt; (Either Text (Maybe Flag)
    -&gt; IO (EvaluationDetail Value, Bool, [EvalEvent], Maybe [Text]))
-&gt; IO (EvaluationDetail Value, Bool, [EvalEvent], Maybe [Text])
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-71"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679673977"><span class="annot"><span class="annottext">err :: Text
</span><a href="#local-6989586621679673977"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-72"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679673976"><span class="annot"><span class="annottext">event :: EvalEvent
</span><a href="#local-6989586621679673976"><span class="hs-identifier hs-var hs-var">event</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value -&gt; EvaluationReason -&gt; Context -&gt; EvalEvent
</span><a href="LaunchDarkly.Server.Events.html#newUnknownFlagEvent"><span class="hs-identifier hs-var">newUnknownFlagEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673985"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679673983"><span class="hs-identifier hs-var">fallback</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonError"><span class="hs-identifier hs-var">EvaluationReasonError</span></a></span><span> </span><span class="annot"><span class="annottext">(EvalErrorKind -&gt; EvaluationReason)
-&gt; EvalErrorKind -&gt; EvaluationReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorExternalStore"><span class="hs-identifier hs-var">EvalErrorExternalStore</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673977"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673984"><span class="hs-identifier hs-var">context</span></a></span><span>
</span><span id="line-73"></span><span>                </span><span class="annot"><span class="annottext">(EvaluationDetail Value, Bool, [EvalEvent], Maybe [Text])
-&gt; IO (EvaluationDetail Value, Bool, [EvalEvent], Maybe [Text])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#errorDetail"><span class="hs-identifier hs-var">errorDetail</span></a></span><span> </span><span class="annot"><span class="annottext">(EvalErrorKind -&gt; EvaluationDetail Value)
-&gt; EvalErrorKind -&gt; EvaluationDetail Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorExternalStore"><span class="hs-identifier hs-var">EvalErrorExternalStore</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673977"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvalEvent -&gt; [EvalEvent]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EvalEvent
</span><a href="#local-6989586621679673976"><span class="hs-identifier hs-var">event</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-75"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679673973"><span class="annot"><span class="annottext">event :: EvalEvent
</span><a href="#local-6989586621679673973"><span class="hs-identifier hs-var hs-var">event</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value -&gt; EvaluationReason -&gt; Context -&gt; EvalEvent
</span><a href="LaunchDarkly.Server.Events.html#newUnknownFlagEvent"><span class="hs-identifier hs-var">newUnknownFlagEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673985"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679673983"><span class="hs-identifier hs-var">fallback</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonError"><span class="hs-identifier hs-var">EvaluationReasonError</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorFlagNotFound"><span class="hs-identifier hs-var">EvalErrorFlagNotFound</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673984"><span class="hs-identifier hs-var">context</span></a></span><span>
</span><span id="line-76"></span><span>                </span><span class="annot"><span class="annottext">(EvaluationDetail Value, Bool, [EvalEvent], Maybe [Text])
-&gt; IO (EvaluationDetail Value, Bool, [EvalEvent], Maybe [Text])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvalErrorKind -&gt; Value -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#errorDefault"><span class="hs-identifier hs-var">errorDefault</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorFlagNotFound"><span class="hs-identifier hs-var">EvalErrorFlagNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679673983"><span class="hs-identifier hs-var">fallback</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvalEvent -&gt; [EvalEvent]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EvalEvent
</span><a href="#local-6989586621679673973"><span class="hs-identifier hs-var">event</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673971"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673971"><span class="hs-identifier hs-var">flag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-78"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679673970"><span class="annot"><span class="annottext">detail :: EvaluationDetail Value
</span><a href="#local-6989586621679673970"><span class="hs-identifier hs-var">detail</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673969"><span class="annot"><span class="annottext">events :: [EvalEvent]
</span><a href="#local-6989586621679673969"><span class="hs-identifier hs-var">events</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673968"><span class="annot"><span class="annottext">prereqs :: Maybe [Text]
</span><a href="#local-6989586621679673968"><span class="hs-identifier hs-var">prereqs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Flag
-&gt; Context
-&gt; HashSet Text
-&gt; StoreHandle IO
-&gt; IO (EvaluationDetail Value, [EvalEvent], Maybe [Text])
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
Flag
-&gt; Context
-&gt; HashSet Text
-&gt; store
-&gt; m (EvaluationDetail Value, [EvalEvent], Maybe [Text])
</span><a href="LaunchDarkly.Server.Evaluate.html#evaluateDetail"><span class="hs-identifier hs-var">evaluateDetail</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673971"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673984"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
forall a. HashSet a
</span><span class="hs-identifier hs-var">HS.empty</span></span><span> </span><span class="annot"><span class="annottext">(StoreHandle IO
 -&gt; IO (EvaluationDetail Value, [EvalEvent], Maybe [Text]))
-&gt; StoreHandle IO
-&gt; IO (EvaluationDetail Value, [EvalEvent], Maybe [Text])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Client -&gt; StoreHandle IO
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;store&quot;</span></span><span> </span><span class="annot"><span class="annottext">Client
</span><a href="#local-6989586621679673986"><span class="hs-identifier hs-var">client</span></a></span><span>
</span><span id="line-79"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679673965"><span class="annot"><span class="annottext">detail' :: EvaluationDetail Value
</span><a href="#local-6989586621679673965"><span class="hs-identifier hs-var hs-var">detail'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Value -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#setFallback"><span class="hs-identifier hs-var">setFallback</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673970"><span class="hs-identifier hs-var">detail</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679673983"><span class="hs-identifier hs-var">fallback</span></a></span><span>
</span><span id="line-80"></span><span>                </span><span class="annot"><span class="annottext">(EvaluationDetail Value, Bool, [EvalEvent], Maybe [Text])
-&gt; IO (EvaluationDetail Value, Bool, [EvalEvent], Maybe [Text])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-81"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673965"><span class="hs-identifier hs-var">detail'</span></a></span><span>
</span><span id="line-82"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-83"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(EvalEvent -&gt; [EvalEvent] -&gt; [EvalEvent])
-&gt; [EvalEvent] -&gt; EvalEvent -&gt; [EvalEvent]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EvalEvent]
</span><a href="#local-6989586621679673969"><span class="hs-identifier hs-var">events</span></a></span><span> </span><span class="annot"><span class="annottext">(EvalEvent -&gt; [EvalEvent]) -&gt; EvalEvent -&gt; [EvalEvent]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-84"></span><span>                        </span><span class="annot"><span class="annottext">Flag
-&gt; Maybe Integer
-&gt; Value
-&gt; Maybe Value
-&gt; EvaluationReason
-&gt; Maybe Text
-&gt; Context
-&gt; EvalEvent
</span><a href="LaunchDarkly.Server.Events.html#newSuccessfulEvalEvent"><span class="hs-identifier hs-var">newSuccessfulEvalEvent</span></a></span><span>
</span><span id="line-85"></span><span>                            </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673971"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-86"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Maybe Integer
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;variationIndex&quot;</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673965"><span class="hs-identifier hs-var">detail'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Value
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;value&quot;</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673965"><span class="hs-identifier hs-var">detail'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679673983"><span class="hs-identifier hs-var">fallback</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; EvaluationReason
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;reason&quot;</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673965"><span class="hs-identifier hs-var">detail'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>                            </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-91"></span><span>                            </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673984"><span class="hs-identifier hs-var">context</span></a></span><span>
</span><span id="line-92"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621679673968"><span class="hs-identifier hs-var">prereqs</span></a></span><span>
</span><span id="line-93"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">Config
-&gt; EventState -&gt; Context -&gt; Bool -&gt; [EvalEvent] -&gt; Bool -&gt; IO ()
</span><a href="LaunchDarkly.Server.Events.html#processEvalEvents"><span class="hs-identifier hs-var">processEvalEvents</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Client -&gt; Config
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;config&quot;</span></span><span> </span><span class="annot"><span class="annottext">Client
</span><a href="#local-6989586621679673986"><span class="hs-identifier hs-var">client</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Client -&gt; EventState
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;events&quot;</span></span><span> </span><span class="annot"><span class="annottext">Client
</span><a href="#local-6989586621679673986"><span class="hs-identifier hs-var">client</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673984"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679673982"><span class="hs-identifier hs-var">includeReason</span></a></span><span> </span><span class="annot"><span class="annottext">[EvalEvent]
</span><a href="#local-6989586621679673979"><span class="hs-identifier hs-var">events</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679673980"><span class="hs-identifier hs-var">unknown</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="annottext">(EvaluationDetail Value, Maybe [Text])
-&gt; IO (EvaluationDetail Value, Maybe [Text])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673981"><span class="hs-identifier hs-var">detail</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621679673978"><span class="hs-identifier hs-var">prereqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#getOffValue"><span class="hs-identifier hs-type">getOffValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationReason"><span class="hs-identifier hs-type">EvaluationReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-98"></span><span id="getOffValue"><span class="annot"><span class="annottext">getOffValue :: Flag -&gt; EvaluationReason -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#getOffValue"><span class="hs-identifier hs-var hs-var">getOffValue</span></a></span></span><span> </span><span id="local-6989586621679673962"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673962"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621679673961"><span class="annot"><span class="annottext">reason :: EvaluationReason
</span><a href="#local-6989586621679673961"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Flag -&gt; Maybe Integer
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;offVariation&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673962"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673960"><span class="annot"><span class="annottext">offVariation :: Integer
</span><a href="#local-6989586621679673960"><span class="hs-identifier hs-var">offVariation</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Flag -&gt; Integer -&gt; EvaluationReason -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#getVariation"><span class="hs-identifier hs-var">getVariation</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673962"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679673960"><span class="hs-identifier hs-var">offVariation</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationReason
</span><a href="#local-6989586621679673961"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">$WEvaluationDetail :: forall value.
value
-&gt; Maybe Integer -&gt; EvaluationReason -&gt; EvaluationDetail value
</span><a href="LaunchDarkly.Server.Details.html#%24WEvaluationDetail"><span class="hs-identifier hs-type hs-type">EvaluationDetail</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:value:EvaluationDetail :: Value
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3Avalue%3AEvaluationDetail"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier hs-var">Null</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:variationIndex:EvaluationDetail :: Maybe Integer
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3AvariationIndex%3AEvaluationDetail"><span class="hs-identifier hs-var">variationIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Integer
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:reason:EvaluationDetail :: EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3Areason%3AEvaluationDetail"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvaluationReason
</span><a href="#local-6989586621679673961"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#getVariation"><span class="hs-identifier hs-type">getVariation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationReason"><span class="hs-identifier hs-type">EvaluationReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-103"></span><span id="getVariation"><span class="annot"><span class="annottext">getVariation :: Flag -&gt; Integer -&gt; EvaluationReason -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#getVariation"><span class="hs-identifier hs-var hs-var">getVariation</span></a></span></span><span> </span><span id="local-6989586621679673954"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673954"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621679673953"><span class="annot"><span class="annottext">index :: Integer
</span><a href="#local-6989586621679673953"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621679673952"><span class="annot"><span class="annottext">reason :: EvaluationReason
</span><a href="#local-6989586621679673952"><span class="hs-identifier hs-var">reason</span></a></span></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679673951"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">$WEvaluationDetail :: forall value.
value
-&gt; Maybe Integer -&gt; EvaluationReason -&gt; EvaluationDetail value
</span><a href="LaunchDarkly.Server.Details.html#%24WEvaluationDetail"><span class="hs-identifier hs-type hs-type">EvaluationDetail</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:value:EvaluationDetail :: Value
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3Avalue%3AEvaluationDetail"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier hs-var">Null</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:variationIndex:EvaluationDetail :: Maybe Integer
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3AvariationIndex%3AEvaluationDetail"><span class="hs-identifier hs-var">variationIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Integer
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:reason:EvaluationDetail :: EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3Areason%3AEvaluationDetail"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonError"><span class="hs-identifier hs-var">EvaluationReasonError</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorKindMalformedFlag"><span class="hs-identifier hs-var">EvalErrorKindMalformedFlag</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679673951"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679673947"><span class="hs-identifier hs-var">variations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">$WEvaluationDetail :: forall value.
value
-&gt; Maybe Integer -&gt; EvaluationReason -&gt; EvaluationDetail value
</span><a href="LaunchDarkly.Server.Details.html#%24WEvaluationDetail"><span class="hs-identifier hs-type hs-type">EvaluationDetail</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:value:EvaluationDetail :: Value
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3Avalue%3AEvaluationDetail"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier hs-var">Null</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:variationIndex:EvaluationDetail :: Maybe Integer
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3AvariationIndex%3AEvaluationDetail"><span class="hs-identifier hs-var">variationIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Integer
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:reason:EvaluationDetail :: EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3Areason%3AEvaluationDetail"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonError"><span class="hs-identifier hs-var">EvaluationReasonError</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorKindMalformedFlag"><span class="hs-identifier hs-var">EvalErrorKindMalformedFlag</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">$WEvaluationDetail :: forall value.
value
-&gt; Maybe Integer -&gt; EvaluationReason -&gt; EvaluationDetail value
</span><a href="LaunchDarkly.Server.Details.html#%24WEvaluationDetail"><span class="hs-identifier hs-type hs-type">EvaluationDetail</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:value:EvaluationDetail :: Value
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3Avalue%3AEvaluationDetail"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Integer -&gt; Value
forall i a. Integral i =&gt; [a] -&gt; i -&gt; a
</span><span class="hs-identifier hs-var">genericIndex</span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679673947"><span class="hs-identifier hs-var">variations</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679673953"><span class="hs-identifier hs-var">index</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:variationIndex:EvaluationDetail :: Maybe Integer
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3AvariationIndex%3AEvaluationDetail"><span class="hs-identifier hs-var">variationIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679673953"><span class="hs-identifier hs-var">index</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:reason:EvaluationDetail :: EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3Areason%3AEvaluationDetail"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvaluationReason
</span><a href="#local-6989586621679673952"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621679673951"><span class="annot"><span class="annottext">idx :: Int
</span><a href="#local-6989586621679673951"><span class="hs-identifier hs-var hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679673953"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621679673947"><span class="annot"><span class="annottext">variations :: [Value]
</span><a href="#local-6989586621679673947"><span class="hs-identifier hs-var hs-var">variations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Flag -&gt; [Value]
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;variations&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673954"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span id="local-6989586621679674241"><span id="local-6989586621679674242"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#evaluateDetail"><span class="hs-identifier hs-type">evaluateDetail</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674242"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier hs-type">LaunchDarklyStoreRead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674241"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674242"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HS.HashSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674241"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674242"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="LaunchDarkly.Server.Events.html#EvalEvent"><span class="hs-identifier hs-type">EvalEvent</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-112"></span><span id="evaluateDetail"><span class="annot"><span class="annottext">evaluateDetail :: Flag
-&gt; Context
-&gt; HashSet Text
-&gt; store
-&gt; m (EvaluationDetail Value, [EvalEvent], Maybe [Text])
</span><a href="LaunchDarkly.Server.Evaluate.html#evaluateDetail"><span class="hs-identifier hs-var hs-var">evaluateDetail</span></a></span></span><span> </span><span id="local-6989586621679673946"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673946"><span class="hs-identifier hs-var">flag</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a s. HasField' &quot;on&quot; s a =&gt; s -&gt; a
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;on&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail Value, [EvalEvent], Maybe [Text])
-&gt; m (EvaluationDetail Value, [EvalEvent], Maybe [Text])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag -&gt; EvaluationReason -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#getOffValue"><span class="hs-identifier hs-var">getOffValue</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673946"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonOff"><span class="hs-identifier hs-var">EvaluationReasonOff</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#evaluateDetail"><span class="hs-identifier hs-var">evaluateDetail</span></a></span><span> </span><span id="local-6989586621679673944"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673944"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621679673943"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673943"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673942"><span class="annot"><span class="annottext">seenFlags :: HashSet Text
</span><a href="#local-6989586621679673942"><span class="hs-identifier hs-var">seenFlags</span></a></span></span><span> </span><span id="local-6989586621679673941"><span class="annot"><span class="annottext">store :: store
</span><a href="#local-6989586621679673941"><span class="hs-identifier hs-var">store</span></a></span></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; HashSet Text -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><span class="hs-identifier hs-var">HS.member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag -&gt; Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673944"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673942"><span class="hs-identifier hs-var">seenFlags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail Value, [EvalEvent], Maybe [Text])
-&gt; m (EvaluationDetail Value, [EvalEvent], Maybe [Text])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag -&gt; EvaluationReason -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#getOffValue"><span class="hs-identifier hs-var">getOffValue</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673944"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(EvaluationReason -&gt; EvaluationDetail Value)
-&gt; EvaluationReason -&gt; EvaluationDetail Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonError"><span class="hs-identifier hs-var">EvaluationReasonError</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorKindMalformedFlag"><span class="hs-identifier hs-var">EvalErrorKindMalformedFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><span class="annottext">Flag
-&gt; Context
-&gt; HashSet Text
-&gt; store
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe [Text])
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
Flag
-&gt; Context
-&gt; HashSet Text
-&gt; store
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe [Text])
</span><a href="LaunchDarkly.Server.Evaluate.html#checkPrerequisites"><span class="hs-identifier hs-var">checkPrerequisites</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673944"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673943"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; HashSet Text -&gt; HashSet Text
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag -&gt; Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673944"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673942"><span class="hs-identifier hs-var">seenFlags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673941"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe [Text])
-&gt; ((Maybe (EvaluationDetail Value), [EvalEvent], Maybe [Text])
    -&gt; m (EvaluationDetail Value, [EvalEvent], Maybe [Text]))
-&gt; m (EvaluationDetail Value, [EvalEvent], Maybe [Text])
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-117"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673937"><span class="annot"><span class="annottext">events :: [EvalEvent]
</span><a href="#local-6989586621679673937"><span class="hs-identifier hs-var">events</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673936"><span class="annot"><span class="annottext">prereqs :: Maybe [Text]
</span><a href="#local-6989586621679673936"><span class="hs-identifier hs-var">prereqs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Flag -&gt; Context -&gt; store -&gt; m (EvaluationDetail Value)
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
Flag -&gt; Context -&gt; store -&gt; m (EvaluationDetail Value)
</span><a href="LaunchDarkly.Server.Evaluate.html#evaluateInternal"><span class="hs-identifier hs-var">evaluateInternal</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673944"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673943"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673941"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">m (EvaluationDetail Value)
-&gt; (EvaluationDetail Value
    -&gt; m (EvaluationDetail Value, [EvalEvent], Maybe [Text]))
-&gt; m (EvaluationDetail Value, [EvalEvent], Maybe [Text])
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679673934"><span class="annot"><span class="annottext">x :: EvaluationDetail Value
</span><a href="#local-6989586621679673934"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail Value, [EvalEvent], Maybe [Text])
-&gt; m (EvaluationDetail Value, [EvalEvent], Maybe [Text])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673934"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EvalEvent]
</span><a href="#local-6989586621679673937"><span class="hs-identifier hs-var">events</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621679673936"><span class="hs-identifier hs-var">prereqs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673933"><span class="annot"><span class="annottext">detail :: EvaluationDetail Value
</span><a href="#local-6989586621679673933"><span class="hs-identifier hs-var">detail</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673932"><span class="annot"><span class="annottext">events :: [EvalEvent]
</span><a href="#local-6989586621679673932"><span class="hs-identifier hs-var">events</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673931"><span class="annot"><span class="annottext">prereqs :: Maybe [Text]
</span><a href="#local-6989586621679673931"><span class="hs-identifier hs-var">prereqs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail Value, [EvalEvent], Maybe [Text])
-&gt; m (EvaluationDetail Value, [EvalEvent], Maybe [Text])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673933"><span class="hs-identifier hs-var">detail</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EvalEvent]
</span><a href="#local-6989586621679673932"><span class="hs-identifier hs-var">events</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621679673931"><span class="hs-identifier hs-var">prereqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span id="local-6989586621679674175"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#status"><span class="hs-identifier hs-type">status</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Prerequisite"><span class="hs-identifier hs-type">Prerequisite</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674175"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-121"></span><span id="status"><span class="annot"><span class="annottext">status :: Prerequisite -&gt; EvaluationDetail a -&gt; Flag -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#status"><span class="hs-identifier hs-var hs-var">status</span></a></span></span><span> </span><span id="local-6989586621679673929"><span class="annot"><span class="annottext">prereq :: Prerequisite
</span><a href="#local-6989586621679673929"><span class="hs-identifier hs-var">prereq</span></a></span></span><span> </span><span id="local-6989586621679673928"><span class="annot"><span class="annottext">result :: EvaluationDetail a
</span><a href="#local-6989586621679673928"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span id="local-6989586621679673927"><span class="annot"><span class="annottext">prereqFlag :: Flag
</span><a href="#local-6989586621679673927"><span class="hs-identifier hs-var">prereqFlag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="annottext">Flag -&gt; Bool
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;on&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673927"><span class="hs-identifier hs-var">prereqFlag</span></a></span><span>
</span><span id="line-123"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail a -&gt; Maybe Integer
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;variationIndex&quot;</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail a
</span><a href="#local-6989586621679673928"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>            </span><span class="annot"><span class="annottext">Maybe Integer -&gt; Maybe Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Prerequisite -&gt; Integer
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;variation&quot;</span></span><span> </span><span class="annot"><span class="annottext">Prerequisite
</span><a href="#local-6989586621679673929"><span class="hs-identifier hs-var">prereq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span id="local-6989586621679674209"><span id="local-6989586621679674210"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#sequenceUntil"><span class="hs-identifier hs-type">sequenceUntil</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674210"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679674209"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679674210"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674209"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674210"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679674209"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-127"></span><span id="sequenceUntil"><span class="annot"><span class="annottext">sequenceUntil :: (a -&gt; Bool) -&gt; [m a] -&gt; m [a]
</span><a href="LaunchDarkly.Server.Evaluate.html#sequenceUntil"><span class="hs-identifier hs-var hs-var">sequenceUntil</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; m [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-128"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#sequenceUntil"><span class="hs-identifier hs-var">sequenceUntil</span></a></span><span> </span><span id="local-6989586621679673924"><span class="annot"><span class="annottext">p :: a -&gt; Bool
</span><a href="#local-6989586621679673924"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679673923"><span class="annot"><span class="annottext">m :: m a
</span><a href="#local-6989586621679673923"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679673922"><span class="annot"><span class="annottext">ms :: [m a]
</span><a href="#local-6989586621679673922"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679673923"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m [a]) -&gt; m [a]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679673921"><span class="annot"><span class="annottext">a :: a
</span><a href="#local-6989586621679673921"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679673924"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679673921"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; m [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679673921"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-132"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Bool) -&gt; [m a] -&gt; m [a]
forall (m :: * -&gt; *) a. Monad m =&gt; (a -&gt; Bool) -&gt; [m a] -&gt; m [a]
</span><a href="LaunchDarkly.Server.Evaluate.html#sequenceUntil"><span class="hs-identifier hs-var">sequenceUntil</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679673924"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[m a]
</span><a href="#local-6989586621679673922"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">m [a] -&gt; ([a] -&gt; m [a]) -&gt; m [a]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679673920"><span class="annot"><span class="annottext">as :: [a]
</span><a href="#local-6989586621679673920"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; m [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679673921"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679673920"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span id="local-6989586621679674219"><span id="local-6989586621679674220"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#checkPrerequisites"><span class="hs-identifier hs-type">checkPrerequisites</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674220"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier hs-type">LaunchDarklyStoreRead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674219"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674220"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HS.HashSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674219"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674220"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="LaunchDarkly.Server.Events.html#EvalEvent"><span class="hs-identifier hs-type">EvalEvent</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-135"></span><span id="checkPrerequisites"><span class="annot"><span class="annottext">checkPrerequisites :: Flag
-&gt; Context
-&gt; HashSet Text
-&gt; store
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe [Text])
</span><a href="LaunchDarkly.Server.Evaluate.html#checkPrerequisites"><span class="hs-identifier hs-var hs-var">checkPrerequisites</span></a></span></span><span> </span><span id="local-6989586621679673919"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673919"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621679673918"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673918"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673917"><span class="annot"><span class="annottext">seenFlags :: HashSet Text
</span><a href="#local-6989586621679673917"><span class="hs-identifier hs-var">seenFlags</span></a></span></span><span> </span><span id="local-6989586621679673916"><span class="annot"><span class="annottext">store :: store
</span><a href="#local-6989586621679673916"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679673915"><span class="annot"><span class="annottext">p :: [Prerequisite]
</span><a href="#local-6989586621679673915"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Flag -&gt; [Prerequisite]
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;prerequisites&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673919"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-137"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Prerequisite] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Prerequisite]
</span><a href="#local-6989586621679673915"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-138"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value), [EvalEvent], Maybe [Text])
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe [Text])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (EvaluationDetail Value)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>                </span><span id="local-6989586621679673913"><span class="annot"><span class="annottext">[(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)]
</span><a href="#local-6989586621679673913"><span class="hs-identifier hs-var">evals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text) -&gt; Bool)
-&gt; [m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)]
-&gt; m [(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)]
forall (m :: * -&gt; *) a. Monad m =&gt; (a -&gt; Bool) -&gt; [m a] -&gt; m [a]
</span><a href="LaunchDarkly.Server.Evaluate.html#sequenceUntil"><span class="hs-identifier hs-var">sequenceUntil</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (EvaluationDetail Value) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value) -&gt; Bool)
-&gt; ((Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
    -&gt; Maybe (EvaluationDetail Value))
-&gt; (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
-&gt; Maybe (EvaluationDetail Value)
forall a b c. (a, b, c) -&gt; a
</span><a href="LaunchDarkly.Server.Util.html#fst3"><span class="hs-identifier hs-var">fst3</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)]
 -&gt; m [(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)])
-&gt; [m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)]
-&gt; m [(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Prerequisite
 -&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text))
-&gt; [Prerequisite]
-&gt; [m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">store
-&gt; Context
-&gt; Flag
-&gt; HashSet Text
-&gt; Prerequisite
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
store
-&gt; Context
-&gt; Flag
-&gt; HashSet Text
-&gt; Prerequisite
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
</span><a href="LaunchDarkly.Server.Evaluate.html#checkPrerequisite"><span class="hs-identifier hs-var">checkPrerequisite</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673916"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673918"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673919"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673917"><span class="hs-identifier hs-var">seenFlags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Prerequisite]
</span><a href="#local-6989586621679673915"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-141"></span><span>                </span><span id="local-6989586621679673910"><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621679673910"><span class="hs-identifier hs-var">prereqs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe [Text] -&gt; m (Maybe [Text])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe [Text] -&gt; m (Maybe [Text]))
-&gt; Maybe [Text] -&gt; m (Maybe [Text])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
 -&gt; Maybe [Text] -&gt; Maybe [Text])
-&gt; Maybe [Text]
-&gt; [(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)]
-&gt; Maybe [Text]
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text -&gt; Maybe [Text] -&gt; Maybe [Text]
forall a. Maybe a -&gt; Maybe [a] -&gt; Maybe [a]
</span><a href="#local-6989586621679673908"><span class="hs-identifier hs-var">collectPrereqs</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Maybe [Text] -&gt; Maybe [Text])
-&gt; ((Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
    -&gt; Maybe Text)
-&gt; (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
-&gt; Maybe [Text]
-&gt; Maybe [Text]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
-&gt; Maybe Text
forall a b c. (a, b, c) -&gt; c
</span><a href="LaunchDarkly.Server.Util.html#trd"><span class="hs-identifier hs-var">trd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)]
</span><a href="#local-6989586621679673913"><span class="hs-identifier hs-var">evals</span></a></span><span>
</span><span id="line-142"></span><span>                </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value), [EvalEvent], Maybe [Text])
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe [Text])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe (EvaluationDetail Value)] -&gt; Maybe (EvaluationDetail Value)
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, MonadPlus m) =&gt;
t (m a) -&gt; m a
</span><span class="hs-identifier hs-var">msum</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (EvaluationDetail Value)]
 -&gt; Maybe (EvaluationDetail Value))
-&gt; [Maybe (EvaluationDetail Value)]
-&gt; Maybe (EvaluationDetail Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
 -&gt; Maybe (EvaluationDetail Value))
-&gt; [(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)]
-&gt; [Maybe (EvaluationDetail Value)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
-&gt; Maybe (EvaluationDetail Value)
forall a b c. (a, b, c) -&gt; a
</span><a href="LaunchDarkly.Server.Util.html#fst3"><span class="hs-identifier hs-var">fst3</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)]
</span><a href="#local-6989586621679673913"><span class="hs-identifier hs-var">evals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
 -&gt; [EvalEvent])
-&gt; [(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)]
-&gt; [EvalEvent]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
-&gt; [EvalEvent]
forall a b c. (a, b, c) -&gt; b
</span><a href="LaunchDarkly.Server.Util.html#snd3"><span class="hs-identifier hs-var">snd3</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)]
</span><a href="#local-6989586621679673913"><span class="hs-identifier hs-var">evals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621679673910"><span class="hs-identifier hs-var">prereqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621679674192"><span class="annot"><a href="#local-6989586621679673908"><span class="hs-identifier hs-type">collectPrereqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679674192"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679674192"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679674192"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621679673908"><span class="annot"><span class="annottext">collectPrereqs :: Maybe a -&gt; Maybe [a] -&gt; Maybe [a]
</span><a href="#local-6989586621679673908"><span class="hs-identifier hs-var hs-var">collectPrereqs</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [a]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><a href="#local-6989586621679673908"><span class="hs-identifier hs-var">collectPrereqs</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673906"><span class="annot"><span class="annottext">x :: [a]
</span><a href="#local-6989586621679673906"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Maybe [a]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679673906"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><a href="#local-6989586621679673908"><span class="hs-identifier hs-var">collectPrereqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673905"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679673905"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Maybe [a]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679673905"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><a href="#local-6989586621679673908"><span class="hs-identifier hs-var">collectPrereqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673904"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679673904"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673903"><span class="annot"><span class="annottext">xs :: [a]
</span><a href="#local-6989586621679673903"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Maybe [a]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679673904"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679673903"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span id="local-6989586621679674195"><span id="local-6989586621679674196"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#checkPrerequisite"><span class="hs-identifier hs-type">checkPrerequisite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674196"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier hs-type">LaunchDarklyStoreRead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674195"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674196"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674195"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HS.HashSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Prerequisite"><span class="hs-identifier hs-type">Prerequisite</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674196"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="LaunchDarkly.Server.Events.html#EvalEvent"><span class="hs-identifier hs-type">EvalEvent</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-151"></span><span id="checkPrerequisite"><span class="annot"><span class="annottext">checkPrerequisite :: store
-&gt; Context
-&gt; Flag
-&gt; HashSet Text
-&gt; Prerequisite
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
</span><a href="LaunchDarkly.Server.Evaluate.html#checkPrerequisite"><span class="hs-identifier hs-var hs-var">checkPrerequisite</span></a></span></span><span> </span><span id="local-6989586621679673902"><span class="annot"><span class="annottext">store :: store
</span><a href="#local-6989586621679673902"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span id="local-6989586621679673901"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673901"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673900"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673900"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621679673899"><span class="annot"><span class="annottext">seenFlags :: HashSet Text
</span><a href="#local-6989586621679673899"><span class="hs-identifier hs-var">seenFlags</span></a></span></span><span> </span><span id="local-6989586621679673898"><span class="annot"><span class="annottext">prereq :: Prerequisite
</span><a href="#local-6989586621679673898"><span class="hs-identifier hs-var">prereq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text -&gt; HashSet Text -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><span class="hs-identifier hs-var">HS.member</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673897"><span class="hs-identifier hs-var">prereqKey</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673899"><span class="hs-identifier hs-var">seenFlags</span></a></span><span>
</span><span id="line-153"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value))
-&gt; EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#errorDetail"><span class="hs-identifier hs-var">errorDetail</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorKindMalformedFlag"><span class="hs-identifier hs-var">EvalErrorKindMalformedFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-155"></span><span>            </span><span class="annot"><span class="annottext">store -&gt; Text -&gt; StoreResultM m (Maybe Flag)
forall store (m :: * -&gt; *).
LaunchDarklyStoreRead store m =&gt;
store -&gt; Text -&gt; StoreResultM m (Maybe Flag)
</span><a href="LaunchDarkly.Server.Store.Internal.html#getFlagC"><span class="hs-identifier hs-var">getFlagC</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673902"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673897"><span class="hs-identifier hs-var">prereqKey</span></a></span><span> </span><span class="annot"><span class="annottext">StoreResultM m (Maybe Flag)
-&gt; (Either Text (Maybe Flag)
    -&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text))
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-156"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679673896"><span class="annot"><span class="annottext">err :: Text
</span><a href="#local-6989586621679673896"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value))
-&gt; EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Flag -&gt; EvaluationReason -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#getOffValue"><span class="hs-identifier hs-var">getOffValue</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673900"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(EvaluationReason -&gt; EvaluationDetail Value)
-&gt; EvaluationReason -&gt; EvaluationDetail Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonError"><span class="hs-identifier hs-var">EvaluationReasonError</span></a></span><span> </span><span class="annot"><span class="annottext">(EvalErrorKind -&gt; EvaluationReason)
-&gt; EvalErrorKind -&gt; EvaluationReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorExternalStore"><span class="hs-identifier hs-var">EvalErrorExternalStore</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673896"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value))
-&gt; EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Flag -&gt; EvaluationReason -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#getOffValue"><span class="hs-identifier hs-var">getOffValue</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673900"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(EvaluationReason -&gt; EvaluationDetail Value)
-&gt; EvaluationReason -&gt; EvaluationDetail Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonPrerequisiteFailed"><span class="hs-identifier hs-var">EvaluationReasonPrerequisiteFailed</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673897"><span class="hs-identifier hs-var">prereqKey</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673897"><span class="hs-identifier hs-var">prereqKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673894"><span class="annot"><span class="annottext">prereqFlag :: Flag
</span><a href="#local-6989586621679673894"><span class="hs-identifier hs-var">prereqFlag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Flag
-&gt; Context
-&gt; HashSet Text
-&gt; store
-&gt; m (EvaluationDetail Value, [EvalEvent], Maybe [Text])
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
Flag
-&gt; Context
-&gt; HashSet Text
-&gt; store
-&gt; m (EvaluationDetail Value, [EvalEvent], Maybe [Text])
</span><a href="LaunchDarkly.Server.Evaluate.html#evaluateDetail"><span class="hs-identifier hs-var">evaluateDetail</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673894"><span class="hs-identifier hs-var">prereqFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673901"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673899"><span class="hs-identifier hs-var">seenFlags</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673902"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">m (EvaluationDetail Value, [EvalEvent], Maybe [Text])
-&gt; ((EvaluationDetail Value, [EvalEvent], Maybe [Text])
    -&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text))
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag
-&gt; (EvaluationDetail Value, [EvalEvent], Maybe [Text])
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
</span><a href="#local-6989586621679673893"><span class="hs-identifier hs-var">process</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673894"><span class="hs-identifier hs-var">prereqFlag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621679673897"><span class="annot"><span class="annottext">prereqKey :: Text
</span><a href="#local-6989586621679673897"><span class="hs-identifier hs-var hs-var">prereqKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Prerequisite -&gt; Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span> </span><span class="annot"><span class="annottext">Prerequisite
</span><a href="#local-6989586621679673898"><span class="hs-identifier hs-var">prereq</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621679673893"><span class="annot"><span class="annottext">process :: Flag
-&gt; (EvaluationDetail Value, [EvalEvent], Maybe [Text])
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
</span><a href="#local-6989586621679673893"><span class="hs-identifier hs-var hs-var">process</span></a></span></span><span> </span><span id="local-6989586621679673892"><span class="annot"><span class="annottext">prereqFlag :: Flag
</span><a href="#local-6989586621679673892"><span class="hs-identifier hs-var">prereqFlag</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679673891"><span class="annot"><span class="annottext">detail :: EvaluationDetail Value
</span><a href="#local-6989586621679673891"><span class="hs-identifier hs-var">detail</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673890"><span class="annot"><span class="annottext">events :: [EvalEvent]
</span><a href="#local-6989586621679673890"><span class="hs-identifier hs-var">events</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673889"><span class="annot"><span class="annottext">_prereqs :: Maybe [Text]
</span><a href="#local-6989586621679673889"><span class="hs-identifier hs-var">_prereqs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EvaluationReason -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#isError"><span class="hs-identifier hs-var">isError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; EvaluationReason
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;reason&quot;</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673891"><span class="hs-identifier hs-var">detail</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value))
-&gt; EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#errorDetail"><span class="hs-identifier hs-var">errorDetail</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorKindMalformedFlag"><span class="hs-identifier hs-var">EvalErrorKindMalformedFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EvalEvent]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673897"><span class="hs-identifier hs-var">prereqKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-164"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679673888"><span class="annot"><span class="annottext">event :: EvalEvent
</span><a href="#local-6989586621679673888"><span class="hs-identifier hs-var hs-var">event</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Flag
-&gt; Maybe Integer
-&gt; Value
-&gt; Maybe Value
-&gt; EvaluationReason
-&gt; Maybe Text
-&gt; Context
-&gt; EvalEvent
</span><a href="LaunchDarkly.Server.Events.html#newSuccessfulEvalEvent"><span class="hs-identifier hs-var">newSuccessfulEvalEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673892"><span class="hs-identifier hs-var">prereqFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Maybe Integer
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;variationIndex&quot;</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673891"><span class="hs-identifier hs-var">detail</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Value
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;value&quot;</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673891"><span class="hs-identifier hs-var">detail</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Value
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; EvaluationReason
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;reason&quot;</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673891"><span class="hs-identifier hs-var">detail</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Text) -&gt; Text -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Flag -&gt; Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673900"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673901"><span class="hs-identifier hs-var">context</span></a></span><span>
</span><span id="line-165"></span><span>                </span><span id="local-6989586621679673887"><span class="annot"><span class="annottext">prereqKey :: Text
</span><a href="#local-6989586621679673887"><span class="hs-identifier hs-var hs-var">prereqKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Flag -&gt; Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673892"><span class="hs-identifier hs-var">prereqFlag</span></a></span><span>
</span><span id="line-166"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Prerequisite -&gt; EvaluationDetail Value -&gt; Flag -&gt; Bool
forall a. Prerequisite -&gt; EvaluationDetail a -&gt; Flag -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#status"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="annot"><span class="annottext">Prerequisite
</span><a href="#local-6989586621679673898"><span class="hs-identifier hs-var">prereq</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673891"><span class="hs-identifier hs-var">detail</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673892"><span class="hs-identifier hs-var">prereqFlag</span></a></span><span>
</span><span id="line-167"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (EvaluationDetail Value)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvalEvent
</span><a href="#local-6989586621679673888"><span class="hs-identifier hs-var">event</span></a></span><span> </span><span class="annot"><span class="annottext">EvalEvent -&gt; [EvalEvent] -&gt; [EvalEvent]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[EvalEvent]
</span><a href="#local-6989586621679673890"><span class="hs-identifier hs-var">events</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673887"><span class="hs-identifier hs-var">prereqKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
-&gt; m (Maybe (EvaluationDetail Value), [EvalEvent], Maybe Text)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value))
-&gt; EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Flag -&gt; EvaluationReason -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#getOffValue"><span class="hs-identifier hs-var">getOffValue</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673900"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(EvaluationReason -&gt; EvaluationDetail Value)
-&gt; EvaluationReason -&gt; EvaluationDetail Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonPrerequisiteFailed"><span class="hs-identifier hs-var">EvaluationReasonPrerequisiteFailed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Prerequisite -&gt; Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span> </span><span class="annot"><span class="annottext">Prerequisite
</span><a href="#local-6989586621679673898"><span class="hs-identifier hs-var">prereq</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvalEvent
</span><a href="#local-6989586621679673888"><span class="hs-identifier hs-var">event</span></a></span><span> </span><span class="annot"><span class="annottext">EvalEvent -&gt; [EvalEvent] -&gt; [EvalEvent]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[EvalEvent]
</span><a href="#local-6989586621679673890"><span class="hs-identifier hs-var">events</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673887"><span class="hs-identifier hs-var">prereqKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span id="local-6989586621679674216"><span id="local-6989586621679674217"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#evaluateInternal"><span class="hs-identifier hs-type">evaluateInternal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674217"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier hs-type">LaunchDarklyStoreRead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674216"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674217"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674216"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674217"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-171"></span><span id="evaluateInternal"><span class="annot"><span class="annottext">evaluateInternal :: Flag -&gt; Context -&gt; store -&gt; m (EvaluationDetail Value)
</span><a href="LaunchDarkly.Server.Evaluate.html#evaluateInternal"><span class="hs-identifier hs-var hs-var">evaluateInternal</span></a></span></span><span> </span><span id="local-6989586621679673886"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673886"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621679673885"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673885"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673884"><span class="annot"><span class="annottext">store :: store
</span><a href="#local-6989586621679673884"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (EvaluationDetail Value)
</span><a href="#local-6989586621679673883"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-173"></span><span>    </span><span id="local-6989586621679673882"><span class="annot"><span class="annottext">fallthrough :: EvaluationDetail Value
</span><a href="#local-6989586621679673882"><span class="hs-identifier hs-var hs-var">fallthrough</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Flag
-&gt; VariationOrRollout
-&gt; Context
-&gt; EvaluationReason
-&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#getValueForVariationOrRollout"><span class="hs-identifier hs-var">getValueForVariationOrRollout</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673886"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag -&gt; VariationOrRollout
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;fallthrough&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673886"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673885"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonFallthrough"><span class="hs-identifier hs-var">EvaluationReasonFallthrough</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621679673883"><span class="annot"><span class="annottext">result :: m (EvaluationDetail Value)
</span><a href="#local-6989586621679673883"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-175"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-176"></span><span>            </span><span id="local-6989586621679673879"><span class="annot"><span class="annottext">targetEvaluationResults :: [m (Maybe (EvaluationDetail Value))]
</span><a href="#local-6989586621679673879"><span class="hs-identifier hs-var hs-var">targetEvaluationResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (EvaluationDetail Value)
-&gt; m (Maybe (EvaluationDetail Value))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value)
 -&gt; m (Maybe (EvaluationDetail Value)))
-&gt; [Maybe (EvaluationDetail Value)]
-&gt; [m (Maybe (EvaluationDetail Value))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Flag -&gt; [Maybe (EvaluationDetail Value)]
</span><a href="LaunchDarkly.Server.Evaluate.html#checkTargets"><span class="hs-identifier hs-var">checkTargets</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673885"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673886"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-177"></span><span>            </span><span id="local-6989586621679673876"><span class="annot"><span class="annottext">ruleEvaluationResults :: [m (Maybe (EvaluationDetail Value))]
</span><a href="#local-6989586621679673876"><span class="hs-identifier hs-var hs-var">ruleEvaluationResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag
-&gt; Context
-&gt; store
-&gt; (Natural, Rule)
-&gt; m (Maybe (EvaluationDetail Value))
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
Flag
-&gt; Context
-&gt; store
-&gt; (Natural, Rule)
-&gt; m (Maybe (EvaluationDetail Value))
</span><a href="LaunchDarkly.Server.Evaluate.html#checkRule"><span class="hs-identifier hs-var">checkRule</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673886"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673885"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673884"><span class="hs-identifier hs-var">store</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Natural, Rule) -&gt; m (Maybe (EvaluationDetail Value)))
-&gt; [(Natural, Rule)] -&gt; [m (Maybe (EvaluationDetail Value))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Natural] -&gt; [Rule] -&gt; [(Natural, Rule)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag -&gt; [Rule]
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;rules&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673886"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>         </span><span class="hs-keyword">in</span><span>
</span><span id="line-179"></span><span>            </span><span class="annot"><span class="annottext">EvaluationDetail Value
-&gt; Maybe (EvaluationDetail Value) -&gt; EvaluationDetail Value
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
</span><a href="#local-6989586621679673882"><span class="hs-identifier hs-var">fallthrough</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value) -&gt; EvaluationDetail Value)
-&gt; m (Maybe (EvaluationDetail Value)) -&gt; m (EvaluationDetail Value)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (EvaluationDetail Value))
 -&gt; m (Maybe (EvaluationDetail Value)))
-&gt; [m (Maybe (EvaluationDetail Value))]
-&gt; m (Maybe (EvaluationDetail Value))
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m (Maybe b)) -&gt; [a] -&gt; m (Maybe b)
</span><span class="hs-identifier hs-var">firstJustM</span></span><span> </span><span class="annot"><span class="annottext">m (Maybe (EvaluationDetail Value))
-&gt; m (Maybe (EvaluationDetail Value))
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">Prelude.id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[m (Maybe (EvaluationDetail Value))]
</span><a href="#local-6989586621679673879"><span class="hs-identifier hs-var">targetEvaluationResults</span></a></span><span> </span><span class="annot"><span class="annottext">[m (Maybe (EvaluationDetail Value))]
-&gt; [m (Maybe (EvaluationDetail Value))]
-&gt; [m (Maybe (EvaluationDetail Value))]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[m (Maybe (EvaluationDetail Value))]
</span><a href="#local-6989586621679673876"><span class="hs-identifier hs-var">ruleEvaluationResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span id="local-6989586621679674166"><span id="local-6989586621679674167"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#checkRule"><span class="hs-identifier hs-type">checkRule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674167"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier hs-type">LaunchDarklyStoreRead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674166"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674167"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674166"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674167"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-182"></span><span id="checkRule"><span class="annot"><span class="annottext">checkRule :: Flag
-&gt; Context
-&gt; store
-&gt; (Natural, Rule)
-&gt; m (Maybe (EvaluationDetail Value))
</span><a href="LaunchDarkly.Server.Evaluate.html#checkRule"><span class="hs-identifier hs-var hs-var">checkRule</span></a></span></span><span> </span><span id="local-6989586621679673873"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673873"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621679673872"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673872"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673871"><span class="annot"><span class="annottext">store :: store
</span><a href="#local-6989586621679673871"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679673870"><span class="annot"><span class="annottext">ruleIndex :: Natural
</span><a href="#local-6989586621679673870"><span class="hs-identifier hs-var">ruleIndex</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673869"><span class="annot"><span class="annottext">rule :: Rule
</span><a href="#local-6989586621679673869"><span class="hs-identifier hs-var">rule</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><span class="annottext">Rule -&gt; Context -&gt; store -&gt; m (Either Text Bool)
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
Rule -&gt; Context -&gt; store -&gt; m (Either Text Bool)
</span><a href="LaunchDarkly.Server.Evaluate.html#ruleMatchesContext"><span class="hs-identifier hs-var">ruleMatchesContext</span></a></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679673869"><span class="hs-identifier hs-var">rule</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673872"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673871"><span class="hs-identifier hs-var">store</span></a></span><span>
</span><span id="line-184"></span><span>        </span><span class="annot"><span class="annottext">m (Either Text Bool)
-&gt; (Either Text Bool -&gt; m (Maybe (EvaluationDetail Value)))
-&gt; m (Maybe (EvaluationDetail Value))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Maybe (EvaluationDetail Value)
-&gt; m (Maybe (EvaluationDetail Value))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value)
 -&gt; m (Maybe (EvaluationDetail Value)))
-&gt; (Either Text Bool -&gt; Maybe (EvaluationDetail Value))
-&gt; Either Text Bool
-&gt; m (Maybe (EvaluationDetail Value))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-185"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value))
-&gt; EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#errorDetail"><span class="hs-identifier hs-var">errorDetail</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorKindMalformedFlag"><span class="hs-identifier hs-var">EvalErrorKindMalformedFlag</span></a></span><span>
</span><span id="line-186"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value))
-&gt; EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Flag
-&gt; VariationOrRollout
-&gt; Context
-&gt; EvaluationReason
-&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#getValueForVariationOrRollout"><span class="hs-identifier hs-var">getValueForVariationOrRollout</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673873"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rule -&gt; VariationOrRollout
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;variationOrRollout&quot;</span></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679673869"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673872"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">$WEvaluationReasonRuleMatch :: Natural -&gt; Text -&gt; Bool -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#%24WEvaluationReasonRuleMatch"><span class="hs-identifier hs-type hs-type">EvaluationReasonRuleMatch</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:ruleIndex:EvaluationReasonOff :: Natural
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3AruleIndex%3AEvaluationReasonOff"><span class="hs-identifier hs-var">ruleIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679673870"><span class="hs-identifier hs-var">ruleIndex</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:ruleId:EvaluationReasonOff :: Text
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3AruleId%3AEvaluationReasonOff"><span class="hs-identifier hs-var">ruleId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule -&gt; Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;id&quot;</span></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679673869"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:inExperiment:EvaluationReasonOff :: Bool
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3AinExperiment%3AEvaluationReasonOff"><span class="hs-identifier hs-var">inExperiment</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">}</span><span>
</span><span id="line-187"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (EvaluationDetail Value)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#checkTargets"><span class="hs-identifier hs-type">checkTargets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-190"></span><span id="checkTargets"><span class="annot"><span class="annottext">checkTargets :: Context -&gt; Flag -&gt; [Maybe (EvaluationDetail Value)]
</span><a href="LaunchDarkly.Server.Evaluate.html#checkTargets"><span class="hs-identifier hs-var hs-var">checkTargets</span></a></span></span><span> </span><span id="local-6989586621679673862"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673862"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673861"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673861"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679673860"><span class="annot"><span class="annottext">userTargets :: [Target]
</span><a href="#local-6989586621679673860"><span class="hs-identifier hs-var hs-var">userTargets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Flag -&gt; [Target]
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;targets&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673861"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-192"></span><span>        </span><span id="local-6989586621679673859"><span class="annot"><span class="annottext">contextTargets :: [Target]
</span><a href="#local-6989586621679673859"><span class="hs-identifier hs-var hs-var">contextTargets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Flag -&gt; [Target]
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;contextTargets&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673861"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-193"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621679673859"><span class="hs-identifier hs-var">contextTargets</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-194"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Text -&gt; Flag -&gt; Target -&gt; Maybe (EvaluationDetail Value)
</span><a href="LaunchDarkly.Server.Evaluate.html#checkTarget"><span class="hs-identifier hs-var">checkTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673862"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673861"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(Target -&gt; Maybe (EvaluationDetail Value))
-&gt; [Target] -&gt; [Maybe (EvaluationDetail Value)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621679673860"><span class="hs-identifier hs-var">userTargets</span></a></span><span>
</span><span id="line-195"></span><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; Flag -&gt; [Target] -&gt; [Target] -&gt; [Maybe (EvaluationDetail Value)]
</span><a href="LaunchDarkly.Server.Evaluate.html#checkContextTargets"><span class="hs-identifier hs-var">checkContextTargets</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673862"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673861"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621679673860"><span class="hs-identifier hs-var">userTargets</span></a></span><span> </span><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621679673859"><span class="hs-identifier hs-var">contextTargets</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#checkContextTargets"><span class="hs-identifier hs-type">checkContextTargets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-198"></span><span id="checkContextTargets"><span class="annot"><span class="annottext">checkContextTargets :: Context
-&gt; Flag -&gt; [Target] -&gt; [Target] -&gt; [Maybe (EvaluationDetail Value)]
</span><a href="LaunchDarkly.Server.Evaluate.html#checkContextTargets"><span class="hs-identifier hs-var hs-var">checkContextTargets</span></a></span></span><span> </span><span id="local-6989586621679673856"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673856"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673855"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673855"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621679673854"><span class="annot"><span class="annottext">userTargets :: [Target]
</span><a href="#local-6989586621679673854"><span class="hs-identifier hs-var">userTargets</span></a></span></span><span> </span><span id="local-6989586621679673853"><span class="annot"><span class="annottext">contextTargets :: [Target]
</span><a href="#local-6989586621679673853"><span class="hs-identifier hs-var">contextTargets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="annottext">Context
-&gt; Flag -&gt; [Target] -&gt; Target -&gt; Maybe (EvaluationDetail Value)
</span><a href="LaunchDarkly.Server.Evaluate.html#checkContextTarget"><span class="hs-identifier hs-var">checkContextTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673856"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673855"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621679673854"><span class="hs-identifier hs-var">userTargets</span></a></span><span> </span><span class="annot"><span class="annottext">(Target -&gt; Maybe (EvaluationDetail Value))
-&gt; [Target] -&gt; [Maybe (EvaluationDetail Value)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621679673853"><span class="hs-identifier hs-var">contextTargets</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#checkContextTarget"><span class="hs-identifier hs-type">checkContextTarget</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span id="checkContextTarget"><span class="annot"><span class="annottext">checkContextTarget :: Context
-&gt; Flag -&gt; [Target] -&gt; Target -&gt; Maybe (EvaluationDetail Value)
</span><a href="LaunchDarkly.Server.Evaluate.html#checkContextTarget"><span class="hs-identifier hs-var hs-var">checkContextTarget</span></a></span></span><span> </span><span id="local-6989586621679673851"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673851"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673850"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673850"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621679673849"><span class="annot"><span class="annottext">userTargets :: [Target]
</span><a href="#local-6989586621679673849"><span class="hs-identifier hs-var">userTargets</span></a></span></span><span> </span><span id="local-6989586621679673848"><span class="annot"><span class="annottext">contextTarget :: Target
</span><a href="#local-6989586621679673848"><span class="hs-identifier hs-var">contextTarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679673847"><span class="annot"><span class="annottext">contextKind :: Text
</span><a href="#local-6989586621679673847"><span class="hs-identifier hs-var hs-var">contextKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Target -&gt; Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;contextKind&quot;</span></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621679673848"><span class="hs-identifier hs-var">contextTarget</span></a></span><span>
</span><span id="line-204"></span><span>        </span><span id="local-6989586621679673846"><span class="annot"><span class="annottext">values :: HashSet Text
</span><a href="#local-6989586621679673846"><span class="hs-identifier hs-var hs-var">values</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Target -&gt; HashSet Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;values&quot;</span></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621679673848"><span class="hs-identifier hs-var">contextTarget</span></a></span><span>
</span><span id="line-205"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673847"><span class="hs-identifier hs-var">contextKind</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">HashSet Text -&gt; Bool
forall a. HashSet a -&gt; Bool
</span><span class="hs-identifier hs-var">HS.null</span></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673846"><span class="hs-identifier hs-var">values</span></a></span><span>
</span><span id="line-206"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- If the context target doesn't have any values specified, we are supposed to fall back to the user targets</span><span>
</span><span id="line-207"></span><span>                </span><span class="annot"><span class="annottext">(Maybe (EvaluationDetail Value) -&gt; Maybe (EvaluationDetail Value))
-&gt; [Maybe (EvaluationDetail Value)]
-&gt; Maybe (EvaluationDetail Value)
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><span class="hs-identifier hs-var">firstJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (EvaluationDetail Value) -&gt; Maybe (EvaluationDetail Value)
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">Prelude.id</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (EvaluationDetail Value)]
 -&gt; Maybe (EvaluationDetail Value))
-&gt; [Maybe (EvaluationDetail Value)]
-&gt; Maybe (EvaluationDetail Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; Text -&gt; Flag -&gt; Target -&gt; Maybe (EvaluationDetail Value)
</span><a href="LaunchDarkly.Server.Evaluate.html#checkTarget"><span class="hs-identifier hs-var">checkTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673851"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673850"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Target -&gt; Maybe (EvaluationDetail Value))
-&gt; [Target] -&gt; [Maybe (EvaluationDetail Value)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621679673849"><span class="hs-identifier hs-var">userTargets</span></a></span><span>
</span><span id="line-208"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Text -&gt; Flag -&gt; Target -&gt; Maybe (EvaluationDetail Value)
</span><a href="LaunchDarkly.Server.Evaluate.html#checkTarget"><span class="hs-identifier hs-var">checkTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673851"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673847"><span class="hs-identifier hs-var">contextKind</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673850"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621679673848"><span class="hs-identifier hs-var">contextTarget</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#checkTarget"><span class="hs-identifier hs-type">checkTarget</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span id="checkTarget"><span class="annot"><span class="annottext">checkTarget :: Context -&gt; Text -&gt; Flag -&gt; Target -&gt; Maybe (EvaluationDetail Value)
</span><a href="LaunchDarkly.Server.Evaluate.html#checkTarget"><span class="hs-identifier hs-var hs-var">checkTarget</span></a></span></span><span> </span><span id="local-6989586621679673844"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673844"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673843"><span class="annot"><span class="annottext">contextKind :: Text
</span><a href="#local-6989586621679673843"><span class="hs-identifier hs-var">contextKind</span></a></span></span><span> </span><span id="local-6989586621679673842"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673842"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621679673841"><span class="annot"><span class="annottext">target :: Target
</span><a href="#local-6989586621679673841"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Context -&gt; Maybe Context
</span><a href="LaunchDarkly.Server.Context.html#getIndividualContext"><span class="hs-identifier hs-var">getIndividualContext</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673843"><span class="hs-identifier hs-var">contextKind</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673844"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-213"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (EvaluationDetail Value)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-214"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673840"><span class="annot"><span class="annottext">ctx :: Context
</span><a href="#local-6989586621679673840"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-215"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text -&gt; HashSet Text -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">elem</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; Text
</span><a href="LaunchDarkly.Server.Context.Internal.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673840"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Target -&gt; HashSet Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;values&quot;</span></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621679673841"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value))
-&gt; EvaluationDetail Value -&gt; Maybe (EvaluationDetail Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Flag -&gt; Integer -&gt; EvaluationReason -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#getVariation"><span class="hs-identifier hs-var">getVariation</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673842"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Target -&gt; Integer
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;variation&quot;</span></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621679673841"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonTargetMatch"><span class="hs-identifier hs-var">EvaluationReasonTargetMatch</span></a></span><span>
</span><span id="line-217"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (EvaluationDetail Value)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#errorDefault"><span class="hs-identifier hs-type">errorDefault</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvalErrorKind"><span class="hs-identifier hs-type">EvalErrorKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-220"></span><span id="errorDefault"><span class="annot"><span class="annottext">errorDefault :: EvalErrorKind -&gt; Value -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#errorDefault"><span class="hs-identifier hs-var hs-var">errorDefault</span></a></span></span><span> </span><span id="local-6989586621679673837"><span class="annot"><span class="annottext">kind :: EvalErrorKind
</span><a href="#local-6989586621679673837"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621679673836"><span class="annot"><span class="annottext">v :: Value
</span><a href="#local-6989586621679673836"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">$WEvaluationDetail :: forall value.
value
-&gt; Maybe Integer -&gt; EvaluationReason -&gt; EvaluationDetail value
</span><a href="LaunchDarkly.Server.Details.html#%24WEvaluationDetail"><span class="hs-identifier hs-type hs-type">EvaluationDetail</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:value:EvaluationDetail :: Value
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3Avalue%3AEvaluationDetail"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679673836"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:variationIndex:EvaluationDetail :: Maybe Integer
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3AvariationIndex%3AEvaluationDetail"><span class="hs-identifier hs-var">variationIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Integer
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:reason:EvaluationDetail :: EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#%24sel%3Areason%3AEvaluationDetail"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonError"><span class="hs-identifier hs-var">EvaluationReasonError</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="#local-6989586621679673837"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#errorDetail"><span class="hs-identifier hs-type">errorDetail</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvalErrorKind"><span class="hs-identifier hs-type">EvalErrorKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-223"></span><span id="errorDetail"><span class="annot"><span class="annottext">errorDetail :: EvalErrorKind -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#errorDetail"><span class="hs-identifier hs-var hs-var">errorDetail</span></a></span></span><span> </span><span id="local-6989586621679673835"><span class="annot"><span class="annottext">kind :: EvalErrorKind
</span><a href="#local-6989586621679673835"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvalErrorKind -&gt; Value -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#errorDefault"><span class="hs-identifier hs-var">errorDefault</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="#local-6989586621679673835"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier hs-var">Null</span></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#getValueForVariationOrRollout"><span class="hs-identifier hs-type">getValueForVariationOrRollout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Flag"><span class="hs-identifier hs-type">Flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#VariationOrRollout"><span class="hs-identifier hs-type">VariationOrRollout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationReason"><span class="hs-identifier hs-type">EvaluationReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationDetail"><span class="hs-identifier hs-type">EvaluationDetail</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-226"></span><span id="getValueForVariationOrRollout"><span class="annot"><span class="annottext">getValueForVariationOrRollout :: Flag
-&gt; VariationOrRollout
-&gt; Context
-&gt; EvaluationReason
-&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#getValueForVariationOrRollout"><span class="hs-identifier hs-var hs-var">getValueForVariationOrRollout</span></a></span></span><span> </span><span id="local-6989586621679673834"><span class="annot"><span class="annottext">flag :: Flag
</span><a href="#local-6989586621679673834"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621679673833"><span class="annot"><span class="annottext">vr :: VariationOrRollout
</span><a href="#local-6989586621679673833"><span class="hs-identifier hs-var">vr</span></a></span></span><span> </span><span id="local-6989586621679673832"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673832"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673831"><span class="annot"><span class="annottext">reason :: EvaluationReason
</span><a href="#local-6989586621679673831"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VariationOrRollout
-&gt; Context -&gt; Text -&gt; Text -&gt; (Maybe Integer, Bool)
</span><a href="LaunchDarkly.Server.Evaluate.html#variationIndexForContext"><span class="hs-identifier hs-var">variationIndexForContext</span></a></span><span> </span><span class="annot"><span class="annottext">VariationOrRollout
</span><a href="#local-6989586621679673833"><span class="hs-identifier hs-var">vr</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673832"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag -&gt; Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673834"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag -&gt; Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;salt&quot;</span></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673834"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-228"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EvalErrorKind -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#errorDetail"><span class="hs-identifier hs-var">errorDetail</span></a></span><span> </span><span class="annot"><span class="annottext">EvalErrorKind
</span><a href="LaunchDarkly.Server.Details.html#EvalErrorKindMalformedFlag"><span class="hs-identifier hs-var">EvalErrorKindMalformedFlag</span></a></span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673829"><span class="annot"><span class="annottext">x :: Integer
</span><a href="#local-6989586621679673829"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673828"><span class="annot"><span class="annottext">inExperiment :: Bool
</span><a href="#local-6989586621679673828"><span class="hs-identifier hs-var">inExperiment</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flag -&gt; Integer -&gt; EvaluationReason -&gt; EvaluationDetail Value
</span><a href="LaunchDarkly.Server.Evaluate.html#getVariation"><span class="hs-identifier hs-var">getVariation</span></a></span><span> </span><span class="annot"><span class="annottext">Flag
</span><a href="#local-6989586621679673834"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679673829"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationReason
</span><a href="#local-6989586621679673831"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EvaluationDetail Value
-&gt; (EvaluationDetail Value -&gt; EvaluationDetail Value)
-&gt; EvaluationDetail Value
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall s t a b. HasField &quot;reason&quot; s t a b =&gt; Lens s t a b
forall (field :: Symbol) s t a b.
HasField field s t a b =&gt;
Lens s t a b
</span><span class="hs-identifier hs-var">field</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;reason&quot;</span></span><span> </span><span class="annot"><span class="annottext">((EvaluationReason -&gt; Identity EvaluationReason)
 -&gt; EvaluationDetail Value -&gt; Identity (EvaluationDetail Value))
-&gt; (EvaluationReason -&gt; EvaluationReason)
-&gt; EvaluationDetail Value
-&gt; EvaluationDetail Value
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; EvaluationReason -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Evaluate.html#setInExperiment"><span class="hs-identifier hs-var">setInExperiment</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679673828"><span class="hs-identifier hs-var">inExperiment</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#setInExperiment"><span class="hs-identifier hs-type">setInExperiment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationReason"><span class="hs-identifier hs-type">EvaluationReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationReason"><span class="hs-identifier hs-type">EvaluationReason</span></a></span><span>
</span><span id="line-232"></span><span id="setInExperiment"><span class="annot"><span class="annottext">setInExperiment :: Bool -&gt; EvaluationReason -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Evaluate.html#setInExperiment"><span class="hs-identifier hs-var hs-var">setInExperiment</span></a></span></span><span> </span><span id="local-6989586621679673826"><span class="annot"><span class="annottext">inExperiment :: Bool
</span><a href="#local-6989586621679673826"><span class="hs-identifier hs-var">inExperiment</span></a></span></span><span> </span><span id="local-6989586621679673825"><span class="annot"><span class="annottext">reason :: EvaluationReason
</span><a href="#local-6989586621679673825"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EvaluationReason
</span><a href="#local-6989586621679673825"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationReasonFallthrough"><span class="hs-identifier hs-type">EvaluationReasonFallthrough</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonFallthrough"><span class="hs-identifier hs-var">EvaluationReasonFallthrough</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679673826"><span class="hs-identifier hs-var">inExperiment</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><a href="LaunchDarkly.Server.Details.html#EvaluationReasonRuleMatch"><span class="hs-identifier hs-type">EvaluationReasonRuleMatch</span></a></span><span> </span><span id="local-6989586621679673824"><span class="annot"><span class="annottext">index :: Natural
</span><a href="#local-6989586621679673824"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621679673823"><span class="annot"><span class="annottext">idx :: Text
</span><a href="#local-6989586621679673823"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Text -&gt; Bool -&gt; EvaluationReason
</span><a href="LaunchDarkly.Server.Details.html#EvaluationReasonRuleMatch"><span class="hs-identifier hs-var">EvaluationReasonRuleMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679673824"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673823"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679673826"><span class="hs-identifier hs-var">inExperiment</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621679673822"><span class="annot"><span class="annottext">x :: EvaluationReason
</span><a href="#local-6989586621679673822"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EvaluationReason
</span><a href="#local-6989586621679673822"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span id="local-6989586621679674154"><span id="local-6989586621679674155"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#ruleMatchesContext"><span class="hs-identifier hs-type">ruleMatchesContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674155"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier hs-type">LaunchDarklyStoreRead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674154"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674155"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Rule"><span class="hs-identifier hs-type">Rule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674154"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674155"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-238"></span><span id="ruleMatchesContext"><span class="annot"><span class="annottext">ruleMatchesContext :: Rule -&gt; Context -&gt; store -&gt; m (Either Text Bool)
</span><a href="LaunchDarkly.Server.Evaluate.html#ruleMatchesContext"><span class="hs-identifier hs-var hs-var">ruleMatchesContext</span></a></span></span><span> </span><span id="local-6989586621679673821"><span class="annot"><span class="annottext">rule :: Rule
</span><a href="#local-6989586621679673821"><span class="hs-identifier hs-var">rule</span></a></span></span><span> </span><span id="local-6989586621679673820"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673820"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673819"><span class="annot"><span class="annottext">store :: store
</span><a href="#local-6989586621679673819"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; Clause -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; [Clause] -&gt; m (Either Text Bool)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">store
-&gt; Context -&gt; Either Text Bool -&gt; Clause -&gt; m (Either Text Bool)
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
store
-&gt; Context -&gt; Either Text Bool -&gt; Clause -&gt; m (Either Text Bool)
</span><a href="#local-6989586621679673818"><span class="hs-identifier hs-var">checkRule</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673819"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673820"><span class="hs-identifier hs-var">context</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679673817"><span class="hs-identifier hs-var">clauses</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621679673817"><span class="annot"><span class="annottext">clauses :: [Clause]
</span><a href="#local-6989586621679673817"><span class="hs-identifier hs-var hs-var">clauses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rule -&gt; [Clause]
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;clauses&quot;</span></span><span> </span><span class="annot"><span class="annottext">Rule
</span><a href="#local-6989586621679673821"><span class="hs-identifier hs-var">rule</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621679674125"><span id="local-6989586621679674126"><span class="annot"><a href="#local-6989586621679673818"><span class="hs-identifier hs-type">checkRule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674126"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier hs-type">LaunchDarklyStoreRead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674125"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674126"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674125"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674126"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621679673818"><span class="annot"><span class="annottext">checkRule :: store
-&gt; Context -&gt; Either Text Bool -&gt; Clause -&gt; m (Either Text Bool)
</span><a href="#local-6989586621679673818"><span class="hs-identifier hs-var hs-var">checkRule</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679673816"><span class="annot"><span class="annottext">e :: Text
</span><a href="#local-6989586621679673816"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text Bool
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673816"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><a href="#local-6989586621679673818"><span class="hs-identifier hs-var">checkRule</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><a href="#local-6989586621679673818"><span class="hs-identifier hs-var">checkRule</span></a></span><span> </span><span id="local-6989586621679673815"><span class="annot"><span class="annottext">store :: store
</span><a href="#local-6989586621679673815"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span id="local-6989586621679673814"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673814"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679673813"><span class="annot"><span class="annottext">clause :: Clause
</span><a href="#local-6989586621679673813"><span class="hs-identifier hs-var">clause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">store -&gt; Clause -&gt; Context -&gt; HashSet Text -&gt; m (Either Text Bool)
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
store -&gt; Clause -&gt; Context -&gt; HashSet Text -&gt; m (Either Text Bool)
</span><a href="LaunchDarkly.Server.Evaluate.html#clauseMatchesContext"><span class="hs-identifier hs-var">clauseMatchesContext</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673815"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673813"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673814"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
forall a. HashSet a
</span><span class="hs-identifier hs-var">HS.empty</span></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#variationIndexForContext"><span class="hs-identifier hs-type">variationIndexForContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#VariationOrRollout"><span class="hs-identifier hs-type">VariationOrRollout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span id="variationIndexForContext"><span class="annot"><span class="annottext">variationIndexForContext :: VariationOrRollout
-&gt; Context -&gt; Text -&gt; Text -&gt; (Maybe Integer, Bool)
</span><a href="LaunchDarkly.Server.Evaluate.html#variationIndexForContext"><span class="hs-identifier hs-var hs-var">variationIndexForContext</span></a></span></span><span> </span><span id="local-6989586621679673811"><span class="annot"><span class="annottext">vor :: VariationOrRollout
</span><a href="#local-6989586621679673811"><span class="hs-identifier hs-var">vor</span></a></span></span><span> </span><span id="local-6989586621679673810"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673810"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673809"><span class="annot"><span class="annottext">key :: Text
</span><a href="#local-6989586621679673809"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span id="local-6989586621679673808"><span class="annot"><span class="annottext">salt :: Text
</span><a href="#local-6989586621679673808"><span class="hs-identifier hs-var">salt</span></a></span></span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673807"><span class="annot"><span class="annottext">variation :: Integer
</span><a href="#local-6989586621679673807"><span class="hs-identifier hs-var">variation</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VariationOrRollout -&gt; Maybe Integer
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;variation&quot;</span></span><span> </span><span class="annot"><span class="annottext">VariationOrRollout
</span><a href="#local-6989586621679673811"><span class="hs-identifier hs-var">vor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679673807"><span class="hs-identifier hs-var">variation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673806"><span class="annot"><span class="annottext">rollout :: Rollout
</span><a href="#local-6989586621679673806"><span class="hs-identifier hs-var">rollout</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VariationOrRollout -&gt; Maybe Rollout
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;rollout&quot;</span></span><span> </span><span class="annot"><span class="annottext">VariationOrRollout
</span><a href="#local-6989586621679673811"><span class="hs-identifier hs-var">vor</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-251"></span><span>            </span><span id="local-6989586621679673805"><span class="annot"><span class="annottext">isRolloutExperiment :: Bool
</span><a href="#local-6989586621679673805"><span class="hs-identifier hs-var hs-var">isRolloutExperiment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rollout -&gt; RolloutKind
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;kind&quot;</span></span><span> </span><span class="annot"><span class="annottext">Rollout
</span><a href="#local-6989586621679673806"><span class="hs-identifier hs-var">rollout</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RolloutKind -&gt; RolloutKind -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RolloutKind
</span><a href="LaunchDarkly.Server.Features.html#RolloutKindExperiment"><span class="hs-identifier hs-var">RolloutKindExperiment</span></a></span><span>
</span><span id="line-252"></span><span>            </span><span id="local-6989586621679673804"><span class="annot"><span class="annottext">bucketBy :: Text
</span><a href="#local-6989586621679673804"><span class="hs-identifier hs-var hs-var">bucketBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Text
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679673805"><span class="hs-identifier hs-var">isRolloutExperiment</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Rollout -&gt; Maybe Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;bucketBy&quot;</span></span><span> </span><span class="annot"><span class="annottext">Rollout
</span><a href="#local-6989586621679673806"><span class="hs-identifier hs-var">rollout</span></a></span><span>
</span><span id="line-253"></span><span>            </span><span id="local-6989586621679673803"><span class="annot"><span class="annottext">variations :: [WeightedVariation]
</span><a href="#local-6989586621679673803"><span class="hs-identifier hs-var hs-var">variations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rollout -&gt; [WeightedVariation]
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;variations&quot;</span></span><span> </span><span class="annot"><span class="annottext">Rollout
</span><a href="#local-6989586621679673806"><span class="hs-identifier hs-var">rollout</span></a></span><span>
</span><span id="line-254"></span><span>            </span><span id="local-6989586621679673802"><span class="annot"><span class="annottext">bucket :: Maybe Float
</span><a href="#local-6989586621679673802"><span class="hs-identifier hs-var hs-var">bucket</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; Maybe Text -&gt; Text -&gt; Text -&gt; Text -&gt; Maybe Int -&gt; Maybe Float
</span><a href="LaunchDarkly.Server.Evaluate.html#bucketContext"><span class="hs-identifier hs-var">bucketContext</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673810"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rollout -&gt; Maybe Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;contextKind&quot;</span></span><span> </span><span class="annot"><span class="annottext">Rollout
</span><a href="#local-6989586621679673806"><span class="hs-identifier hs-var">rollout</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673809"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673804"><span class="hs-identifier hs-var">bucketBy</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673808"><span class="hs-identifier hs-var">salt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rollout -&gt; Maybe Int
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;seed&quot;</span></span><span> </span><span class="annot"><span class="annottext">Rollout
</span><a href="#local-6989586621679673806"><span class="hs-identifier hs-var">rollout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>            </span><span id="local-6989586621679673800"><span class="annot"><span class="annottext">isExperiment :: Bool
</span><a href="#local-6989586621679673800"><span class="hs-identifier hs-var hs-var">isExperiment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679673805"><span class="hs-identifier hs-var">isRolloutExperiment</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Float -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe Float
</span><a href="#local-6989586621679673802"><span class="hs-identifier hs-var">bucket</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>            </span><span id="local-6989586621679673799"><span class="annot"><span class="annottext">c :: Either (Maybe Integer, Bool) Float
-&gt; WeightedVariation -&gt; Either (Maybe Integer, Bool) Float
</span><a href="#local-6989586621679673799"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679673798"><span class="annot"><span class="annottext">acc :: Either (Maybe Integer, Bool) Float
</span><a href="#local-6989586621679673798"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679673797"><span class="annot"><span class="annottext">i :: WeightedVariation
</span><a href="#local-6989586621679673797"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-257"></span><span>                </span><span class="annot"><span class="annottext">Either (Maybe Integer, Bool) Float
</span><a href="#local-6989586621679673798"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Either (Maybe Integer, Bool) Float
-&gt; (Float -&gt; Either (Maybe Integer, Bool) Float)
-&gt; Either (Maybe Integer, Bool) Float
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679673796"><span class="annot"><span class="annottext">acc :: Float
</span><a href="#local-6989586621679673796"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-258"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679673795"><span class="annot"><span class="annottext">t :: Float
</span><a href="#local-6989586621679673795"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679673796"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">WeightedVariation -&gt; Float
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;weight&quot;</span></span><span> </span><span class="annot"><span class="annottext">WeightedVariation
</span><a href="#local-6989586621679673797"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="hs-number">100000.0</span></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Float
</span><a href="#local-6989586621679673802"><span class="hs-identifier hs-var">bucket</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-260"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673792"><span class="annot"><span class="annottext">v :: Float
</span><a href="#local-6989586621679673792"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679673792"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679673795"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Either (Maybe Integer, Bool) Float
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679673795"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-261"></span><span>                            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe Integer, Bool) -&gt; Either (Maybe Integer, Bool) Float
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Maybe Integer) -&gt; Integer -&gt; Maybe Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WeightedVariation -&gt; Integer
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;variation&quot;</span></span><span> </span><span class="annot"><span class="annottext">WeightedVariation
</span><a href="#local-6989586621679673797"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WeightedVariation -&gt; Bool
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;untracked&quot;</span></span><span> </span><span class="annot"><span class="annottext">WeightedVariation
</span><a href="#local-6989586621679673797"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679673800"><span class="hs-identifier hs-var">isExperiment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>         </span><span class="hs-keyword">in</span><span>
</span><span id="line-263"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[WeightedVariation] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[WeightedVariation]
</span><a href="#local-6989586621679673803"><span class="hs-identifier hs-var">variations</span></a></span><span>
</span><span id="line-264"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Integer
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-266"></span><span>                    </span><span class="annot"><span class="annottext">(Maybe Integer, Bool)
-&gt; Either (Maybe Integer, Bool) Float -&gt; (Maybe Integer, Bool)
forall a b. a -&gt; Either a b -&gt; a
</span><span class="hs-identifier hs-var">fromLeft</span></span><span>
</span><span id="line-267"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Maybe Integer) -&gt; Integer -&gt; Maybe Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a s. HasField' &quot;variation&quot; s a =&gt; s -&gt; a
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;variation&quot;</span></span><span> </span><span class="annot"><span class="annottext">(WeightedVariation -&gt; Integer) -&gt; WeightedVariation -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[WeightedVariation] -&gt; WeightedVariation
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[WeightedVariation]
</span><a href="#local-6989586621679673803"><span class="hs-identifier hs-var">variations</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a s. HasField' &quot;untracked&quot; s a =&gt; s -&gt; a
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;untracked&quot;</span></span><span> </span><span class="annot"><span class="annottext">(WeightedVariation -&gt; Bool) -&gt; WeightedVariation -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[WeightedVariation] -&gt; WeightedVariation
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[WeightedVariation]
</span><a href="#local-6989586621679673803"><span class="hs-identifier hs-var">variations</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679673800"><span class="hs-identifier hs-var">isExperiment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>                        </span><span class="annot"><span class="annottext">(Either (Maybe Integer, Bool) Float -&gt; (Maybe Integer, Bool))
-&gt; Either (Maybe Integer, Bool) Float -&gt; (Maybe Integer, Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Either (Maybe Integer, Bool) Float
 -&gt; WeightedVariation -&gt; Either (Maybe Integer, Bool) Float)
-&gt; Either (Maybe Integer, Bool) Float
-&gt; [WeightedVariation]
-&gt; Either (Maybe Integer, Bool) Float
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Either (Maybe Integer, Bool) Float
-&gt; WeightedVariation -&gt; Either (Maybe Integer, Bool) Float
</span><a href="#local-6989586621679673799"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float -&gt; Either (Maybe Integer, Bool) Float
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0.0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[WeightedVariation]
</span><a href="#local-6989586621679673803"><span class="hs-identifier hs-var">variations</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Integer
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-comment">-- Bucketing -------------------------------------------------------------------</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#hexCharToNumber"><span class="hs-identifier hs-type">hexCharToNumber</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-274"></span><span id="hexCharToNumber"><span class="annot"><span class="annottext">hexCharToNumber :: Word8 -&gt; Maybe Natural
</span><a href="LaunchDarkly.Server.Evaluate.html#hexCharToNumber"><span class="hs-identifier hs-var hs-var">hexCharToNumber</span></a></span></span><span> </span><span id="local-6989586621679673787"><span class="annot"><span class="annottext">w :: Word8
</span><a href="#local-6989586621679673787"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><span class="annottext">(Word8 -&gt; Natural) -&gt; Maybe Word8 -&gt; Maybe Natural
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Word8 -&gt; Maybe Natural) -&gt; Maybe Word8 -&gt; Maybe Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-276"></span><span>        </span><span class="hs-keyword">if</span><span>
</span><span id="line-277"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-number">48</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679673787"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679673787"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="hs-number">57</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Maybe Word8
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Maybe Word8) -&gt; Word8 -&gt; Maybe Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679673787"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="hs-number">48</span></span><span>
</span><span id="line-278"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-number">65</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679673787"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679673787"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="hs-number">70</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Maybe Word8
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Maybe Word8) -&gt; Word8 -&gt; Maybe Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679673787"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="hs-number">55</span></span><span>
</span><span id="line-279"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-number">97</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679673787"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679673787"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="hs-number">102</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Maybe Word8
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Maybe Word8) -&gt; Word8 -&gt; Maybe Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679673787"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="hs-number">87</span></span><span>
</span><span id="line-280"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Word8
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#hexStringToNumber"><span class="hs-identifier hs-type">hexStringToNumber</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-283"></span><span id="hexStringToNumber"><span class="annot"><span class="annottext">hexStringToNumber :: ByteString -&gt; Maybe Natural
</span><a href="LaunchDarkly.Server.Evaluate.html#hexStringToNumber"><span class="hs-identifier hs-var hs-var">hexStringToNumber</span></a></span></span><span> </span><span id="local-6989586621679673784"><span class="annot"><span class="annottext">bytes :: ByteString
</span><a href="#local-6989586621679673784"><span class="hs-identifier hs-var">bytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe Natural -&gt; Word8 -&gt; Maybe Natural)
-&gt; Maybe Natural -&gt; ByteString -&gt; Maybe Natural
forall a. (a -&gt; Word8 -&gt; a) -&gt; a -&gt; ByteString -&gt; a
</span><span class="hs-identifier hs-var">B.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Maybe Natural -&gt; Word8 -&gt; Maybe Natural
</span><a href="#local-6989586621679673782"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Maybe Natural
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679673784"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-285"></span><span>    </span><span id="local-6989586621679673782"><span class="annot"><span class="annottext">step :: Maybe Natural -&gt; Word8 -&gt; Maybe Natural
</span><a href="#local-6989586621679673782"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span id="local-6989586621679673781"><span class="annot"><span class="annottext">acc :: Maybe Natural
</span><a href="#local-6989586621679673781"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679673780"><span class="annot"><span class="annottext">x :: Word8
</span><a href="#local-6989586621679673780"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Natural
</span><a href="#local-6989586621679673781"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Natural -&gt; (Natural -&gt; Maybe Natural) -&gt; Maybe Natural
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679673779"><span class="annot"><span class="annottext">acc' :: Natural
</span><a href="#local-6989586621679673779"><span class="hs-identifier hs-var">acc'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Maybe Natural
</span><a href="LaunchDarkly.Server.Evaluate.html#hexCharToNumber"><span class="hs-identifier hs-var">hexCharToNumber</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679673780"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Natural -&gt; (Natural -&gt; Maybe Natural) -&gt; Maybe Natural
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Maybe Natural
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Maybe Natural)
-&gt; (Natural -&gt; Natural) -&gt; Natural -&gt; Maybe Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679673779"><span class="hs-identifier hs-var">acc'</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="hs-number">16</span></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#bucketContext"><span class="hs-identifier hs-type">bucketContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-288"></span><span id="bucketContext"><span class="annot"><span class="annottext">bucketContext :: Context
-&gt; Maybe Text -&gt; Text -&gt; Text -&gt; Text -&gt; Maybe Int -&gt; Maybe Float
</span><a href="LaunchDarkly.Server.Evaluate.html#bucketContext"><span class="hs-identifier hs-var hs-var">bucketContext</span></a></span></span><span> </span><span id="local-6989586621679673777"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673777"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673776"><span class="annot"><span class="annottext">kind :: Maybe Text
</span><a href="#local-6989586621679673776"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621679673775"><span class="annot"><span class="annottext">key :: Text
</span><a href="#local-6989586621679673775"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span id="local-6989586621679673774"><span class="annot"><span class="annottext">attribute :: Text
</span><a href="#local-6989586621679673774"><span class="hs-identifier hs-var">attribute</span></a></span></span><span> </span><span id="local-6989586621679673773"><span class="annot"><span class="annottext">salt :: Text
</span><a href="#local-6989586621679673773"><span class="hs-identifier hs-var">salt</span></a></span></span><span> </span><span id="local-6989586621679673772"><span class="annot"><span class="annottext">seed :: Maybe Int
</span><a href="#local-6989586621679673772"><span class="hs-identifier hs-var">seed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679673771"><span class="annot"><span class="annottext">bucketBy :: Reference
</span><a href="#local-6989586621679673771"><span class="hs-identifier hs-var hs-var">bucketBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679673776"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-290"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Reference
</span><a href="LaunchDarkly.Server.Reference.html#makeLiteral"><span class="hs-identifier hs-var">makeLiteral</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673774"><span class="hs-identifier hs-var">attribute</span></a></span><span>
</span><span id="line-291"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Reference
</span><a href="LaunchDarkly.Server.Reference.html#makeReference"><span class="hs-identifier hs-var">makeReference</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673774"><span class="hs-identifier hs-var">attribute</span></a></span><span>
</span><span id="line-292"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Context -&gt; Maybe Context
</span><a href="LaunchDarkly.Server.Context.html#getIndividualContext"><span class="hs-identifier hs-var">getIndividualContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Text
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679673776"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673777"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-293"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Float
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-294"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673770"><span class="annot"><span class="annottext">ctx :: Context
</span><a href="#local-6989586621679673770"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-295"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679673769"><span class="annot"><span class="annottext">bucketableString :: Maybe Text
</span><a href="#local-6989586621679673769"><span class="hs-identifier hs-var hs-var">bucketableString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Maybe Text
</span><a href="LaunchDarkly.Server.Evaluate.html#bucketableStringValue"><span class="hs-identifier hs-var">bucketableStringValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Maybe Text) -&gt; Value -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Context -&gt; Value
</span><a href="LaunchDarkly.Server.Context.html#getValueForReference"><span class="hs-identifier hs-var">getValueForReference</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679673771"><span class="hs-identifier hs-var">bucketBy</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673770"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-296"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Maybe Float
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Float -&gt; Maybe Float) -&gt; Float -&gt; Maybe Float
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Text -&gt; Text -&gt; Maybe Int -&gt; Float
</span><a href="LaunchDarkly.Server.Evaluate.html#calculateBucketValue"><span class="hs-identifier hs-var">calculateBucketValue</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679673769"><span class="hs-identifier hs-var">bucketableString</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673775"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673773"><span class="hs-identifier hs-var">salt</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679673772"><span class="hs-identifier hs-var">seed</span></a></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#calculateBucketValue"><span class="hs-identifier hs-type">calculateBucketValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-299"></span><span id="calculateBucketValue"><span class="annot"><span class="annottext">calculateBucketValue :: Maybe Text -&gt; Text -&gt; Text -&gt; Maybe Int -&gt; Float
</span><a href="LaunchDarkly.Server.Evaluate.html#calculateBucketValue"><span class="hs-identifier hs-var hs-var">calculateBucketValue</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-300"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#calculateBucketValue"><span class="hs-identifier hs-var">calculateBucketValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673766"><span class="annot"><span class="annottext">text :: Text
</span><a href="#local-6989586621679673766"><span class="hs-identifier hs-var">text</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679673765"><span class="annot"><span class="annottext">key :: Text
</span><a href="#local-6989586621679673765"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span id="local-6989586621679673764"><span class="annot"><span class="annottext">salt :: Text
</span><a href="#local-6989586621679673764"><span class="hs-identifier hs-var">salt</span></a></span></span><span> </span><span id="local-6989586621679673763"><span class="annot"><span class="annottext">seed :: Maybe Int
</span><a href="#local-6989586621679673763"><span class="hs-identifier hs-var">seed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679673762"><span class="annot"><span class="annottext">seed' :: Text
</span><a href="#local-6989586621679673762"><span class="hs-identifier hs-var hs-var">seed'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679673763"><span class="hs-identifier hs-var">seed</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-302"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673765"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673764"><span class="hs-identifier hs-var">salt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673766"><span class="hs-identifier hs-var">text</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-303"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673760"><span class="annot"><span class="annottext">seed' :: Int
</span><a href="#local-6989586621679673760"><span class="hs-identifier hs-var">seed'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679673760"><span class="hs-identifier hs-var">seed'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673766"><span class="hs-identifier hs-var">text</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-304"></span><span>        </span><span id="local-6989586621679673757"><span class="annot"><span class="annottext">byteString :: ByteString
</span><a href="#local-6989586621679673757"><span class="hs-identifier hs-var hs-var">byteString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B.take</span></span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">B16.encode</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">hash</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">encodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ByteString) -&gt; Text -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673762"><span class="hs-identifier hs-var">seed'</span></a></span><span>
</span><span id="line-305"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Float
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Float) -&gt; Natural -&gt; Float
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Natural -&gt; Natural
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Natural -&gt; Natural) -&gt; Maybe Natural -&gt; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Natural
</span><a href="LaunchDarkly.Server.Evaluate.html#hexStringToNumber"><span class="hs-identifier hs-var">hexStringToNumber</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679673757"><span class="hs-identifier hs-var">byteString</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="hs-number">0xFFFFFFFFFFFFFFF</span></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#floatingOrInteger%27"><span class="hs-identifier hs-type">floatingOrInteger'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Scientific</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-308"></span><span id="floatingOrInteger%27"><span class="annot"><span class="annottext">floatingOrInteger' :: Scientific -&gt; Either Double Integer
</span><a href="LaunchDarkly.Server.Evaluate.html#floatingOrInteger%27"><span class="hs-identifier hs-var hs-var">floatingOrInteger'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; Either Double Integer
forall r i. (RealFloat r, Integral i) =&gt; Scientific -&gt; Either r i
</span><span class="hs-identifier hs-var">floatingOrInteger</span></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#bucketableStringValue"><span class="hs-identifier hs-type">bucketableStringValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-311"></span><span id="bucketableStringValue"><span class="annot"><span class="annottext">bucketableStringValue :: Value -&gt; Maybe Text
</span><a href="LaunchDarkly.Server.Evaluate.html#bucketableStringValue"><span class="hs-identifier hs-var hs-var">bucketableStringValue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span id="local-6989586621679673752"><span class="annot"><span class="annottext">x :: Text
</span><a href="#local-6989586621679673752"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673752"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-312"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#bucketableStringValue"><span class="hs-identifier hs-var">bucketableStringValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Number</span></span><span> </span><span id="local-6989586621679673750"><span class="annot"><span class="annottext">s :: Scientific
</span><a href="#local-6989586621679673750"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Maybe Text)
-&gt; (Integer -&gt; Maybe Text) -&gt; Either Double Integer -&gt; Maybe Text
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text -&gt; Double -&gt; Maybe Text
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Text) -&gt; (Integer -&gt; Text) -&gt; Integer -&gt; Maybe Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; (Integer -&gt; String) -&gt; Integer -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scientific -&gt; Either Double Integer
</span><a href="LaunchDarkly.Server.Evaluate.html#floatingOrInteger%27"><span class="hs-identifier hs-var">floatingOrInteger'</span></a></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679673750"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#bucketableStringValue"><span class="hs-identifier hs-var">bucketableStringValue</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="hs-comment">-- Clause ----------------------------------------------------------------------</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#maybeNegate"><span class="hs-identifier hs-type">maybeNegate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-318"></span><span id="maybeNegate"><span class="annot"><span class="annottext">maybeNegate :: Clause -&gt; Bool -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#maybeNegate"><span class="hs-identifier hs-var hs-var">maybeNegate</span></a></span></span><span> </span><span id="local-6989586621679673746"><span class="annot"><span class="annottext">clause :: Clause
</span><a href="#local-6989586621679673746"><span class="hs-identifier hs-var">clause</span></a></span></span><span> </span><span id="local-6989586621679673745"><span class="annot"><span class="annottext">value :: Bool
</span><a href="#local-6989586621679673745"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Bool
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;negate&quot;</span></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673746"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679673745"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679673745"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="hs-comment">-- For a given clause, determine if the provided value matches that clause.</span><span>
</span><span id="line-321"></span><span class="hs-comment">--</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- The operation to be check and the values to compare against are both extract from within the Clause itself.</span><span>
</span><span id="line-323"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#matchAnyClauseValue"><span class="hs-identifier hs-type">matchAnyClauseValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-324"></span><span id="matchAnyClauseValue"><span class="annot"><span class="annottext">matchAnyClauseValue :: Clause -&gt; Value -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#matchAnyClauseValue"><span class="hs-identifier hs-var hs-var">matchAnyClauseValue</span></a></span></span><span> </span><span id="local-6989586621679673743"><span class="annot"><span class="annottext">clause :: Clause
</span><a href="#local-6989586621679673743"><span class="hs-identifier hs-var">clause</span></a></span></span><span> </span><span id="local-6989586621679673742"><span class="annot"><span class="annottext">contextValue :: Value
</span><a href="#local-6989586621679673742"><span class="hs-identifier hs-var">contextValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Bool) -&gt; [Value] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
</span><a href="#local-6989586621679673740"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679673742"><span class="hs-identifier hs-var">contextValue</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679673739"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621679673740"><span class="annot"><span class="annottext">f :: Value -&gt; Value -&gt; Bool
</span><a href="#local-6989586621679673740"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Op -&gt; Value -&gt; Value -&gt; Bool
</span><a href="LaunchDarkly.Server.Operators.html#getOperation"><span class="hs-identifier hs-var">getOperation</span></a></span><span> </span><span class="annot"><span class="annottext">(Op -&gt; Value -&gt; Value -&gt; Bool) -&gt; Op -&gt; Value -&gt; Value -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Op
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;op&quot;</span></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673743"><span class="hs-identifier hs-var">clause</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621679673739"><span class="annot"><span class="annottext">v :: [Value]
</span><a href="#local-6989586621679673739"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Clause -&gt; [Value]
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;values&quot;</span></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673743"><span class="hs-identifier hs-var">clause</span></a></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-comment">-- If attribute is &quot;kind&quot;, then we treat operator and values as a match expression against a list of all individual</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- kinds in the context. That is, for a multi-kind context with kinds of &quot;org&quot; and &quot;user&quot;, it is a match if either</span><span>
</span><span id="line-331"></span><span class="hs-comment">-- of those strings is a match with Operator and Values.</span><span>
</span><span id="line-332"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#clauseMatchesByKind"><span class="hs-identifier hs-type">clauseMatchesByKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-333"></span><span id="clauseMatchesByKind"><span class="annot"><span class="annottext">clauseMatchesByKind :: Clause -&gt; Context -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#clauseMatchesByKind"><span class="hs-identifier hs-var hs-var">clauseMatchesByKind</span></a></span></span><span> </span><span id="local-6989586621679673737"><span class="annot"><span class="annottext">clause :: Clause
</span><a href="#local-6989586621679673737"><span class="hs-identifier hs-var">clause</span></a></span></span><span> </span><span id="local-6989586621679673736"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673736"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool -&gt; Bool) -&gt; Bool -&gt; [Text] -&gt; Bool
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool -&gt; Bool
</span><a href="#local-6989586621679673735"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; [Text]
</span><a href="LaunchDarkly.Server.Context.Internal.html#getKinds"><span class="hs-identifier hs-var">getKinds</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673736"><span class="hs-identifier hs-var">context</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-335"></span><span>    </span><span id="local-6989586621679673735"><span class="annot"><span class="annottext">f :: Text -&gt; Bool -&gt; Bool
</span><a href="#local-6989586621679673735"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679673734"><span class="annot"><span class="annottext">kind :: Text
</span><a href="#local-6989586621679673734"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621679673733"><span class="annot"><span class="annottext">result :: Bool
</span><a href="#local-6989586621679673733"><span class="hs-identifier hs-var">result</span></a></span></span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679673733"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Value -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#matchAnyClauseValue"><span class="hs-identifier hs-var">matchAnyClauseValue</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673737"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">String</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673734"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#clauseMatchesContextNoSegments"><span class="hs-identifier hs-type">clauseMatchesContextNoSegments</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-340"></span><span id="clauseMatchesContextNoSegments"><span class="annot"><span class="annottext">clauseMatchesContextNoSegments :: Clause -&gt; Context -&gt; Either Text Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#clauseMatchesContextNoSegments"><span class="hs-identifier hs-var hs-var">clauseMatchesContextNoSegments</span></a></span></span><span> </span><span id="local-6989586621679673731"><span class="annot"><span class="annottext">clause :: Clause
</span><a href="#local-6989586621679673731"><span class="hs-identifier hs-var">clause</span></a></span></span><span> </span><span id="local-6989586621679673730"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673730"><span class="hs-identifier hs-var">context</span></a></span></span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Bool
</span><a href="LaunchDarkly.Server.Reference.html#isValid"><span class="hs-identifier hs-var">isValid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause -&gt; Reference
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;attribute&quot;</span></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673731"><span class="hs-identifier hs-var">clause</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text Bool
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Either Text Bool) -&gt; Text -&gt; Either Text Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Text
</span><a href="LaunchDarkly.Server.Reference.html#getError"><span class="hs-identifier hs-var">getError</span></a></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Text) -&gt; Reference -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Reference
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;attribute&quot;</span></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673731"><span class="hs-identifier hs-var">clause</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;kind&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; [Text]
</span><a href="LaunchDarkly.Server.Reference.html#getComponents"><span class="hs-identifier hs-var">getComponents</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause -&gt; Reference
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;attribute&quot;</span></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673731"><span class="hs-identifier hs-var">clause</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Either Text Bool) -&gt; Bool -&gt; Either Text Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Bool -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#maybeNegate"><span class="hs-identifier hs-var">maybeNegate</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673731"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Context -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#clauseMatchesByKind"><span class="hs-identifier hs-var">clauseMatchesByKind</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673731"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673730"><span class="hs-identifier hs-var">context</span></a></span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Context -&gt; Maybe Context
</span><a href="LaunchDarkly.Server.Context.html#getIndividualContext"><span class="hs-identifier hs-var">getIndividualContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause -&gt; Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;contextKind&quot;</span></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673731"><span class="hs-identifier hs-var">clause</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673730"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-344"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-345"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673729"><span class="annot"><span class="annottext">ctx :: Context
</span><a href="#local-6989586621679673729"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Context -&gt; Value
</span><a href="LaunchDarkly.Server.Context.html#getValueForReference"><span class="hs-identifier hs-var">getValueForReference</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause -&gt; Reference
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;attribute&quot;</span></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673731"><span class="hs-identifier hs-var">clause</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673729"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-346"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Null</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-347"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span id="local-6989586621679673727"><span class="annot"><span class="annottext">a :: Array
</span><a href="#local-6989586621679673727"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Either Text Bool) -&gt; Bool -&gt; Either Text Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Bool -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#maybeNegate"><span class="hs-identifier hs-var">maybeNegate</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673731"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Bool) -&gt; Array -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause -&gt; Value -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#matchAnyClauseValue"><span class="hs-identifier hs-var">matchAnyClauseValue</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673731"><span class="hs-identifier hs-var">clause</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679673727"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-348"></span><span>            </span><span id="local-6989586621679673726"><span class="annot"><span class="annottext">x :: Value
</span><a href="#local-6989586621679673726"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Either Text Bool) -&gt; Bool -&gt; Either Text Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Bool -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#maybeNegate"><span class="hs-identifier hs-var">maybeNegate</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673731"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Value -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#matchAnyClauseValue"><span class="hs-identifier hs-var">matchAnyClauseValue</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673731"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679673726"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span id="local-6989586621679674119"><span id="local-6989586621679674120"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#clauseMatchesContext"><span class="hs-identifier hs-type">clauseMatchesContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674120"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier hs-type">LaunchDarklyStoreRead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674119"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674120"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674119"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HS.HashSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674120"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-351"></span><span id="clauseMatchesContext"><span class="annot"><span class="annottext">clauseMatchesContext :: store -&gt; Clause -&gt; Context -&gt; HashSet Text -&gt; m (Either Text Bool)
</span><a href="LaunchDarkly.Server.Evaluate.html#clauseMatchesContext"><span class="hs-identifier hs-var hs-var">clauseMatchesContext</span></a></span></span><span> </span><span id="local-6989586621679673725"><span class="annot"><span class="annottext">store :: store
</span><a href="#local-6989586621679673725"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span id="local-6989586621679673724"><span class="annot"><span class="annottext">clause :: Clause
</span><a href="#local-6989586621679673724"><span class="hs-identifier hs-var">clause</span></a></span></span><span> </span><span id="local-6989586621679673723"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673723"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673722"><span class="annot"><span class="annottext">seenSegments :: HashSet Text
</span><a href="#local-6989586621679673722"><span class="hs-identifier hs-var">seenSegments</span></a></span></span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Op
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;op&quot;</span></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673724"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="annot"><span class="annottext">Op -&gt; Op -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Op
</span><a href="LaunchDarkly.Server.Operators.html#OpSegmentMatch"><span class="hs-identifier hs-var">OpSegmentMatch</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-353"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679673721"><span class="annot"><span class="annottext">values :: [Text]
</span><a href="#local-6989586621679673721"><span class="hs-identifier hs-var hs-var">values</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673720"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span id="local-6989586621679673720"><span class="annot"><span class="annottext">x :: Text
</span><a href="#local-6989586621679673720"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Clause -&gt; [Value]
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;values&quot;</span></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673724"><span class="hs-identifier hs-var">clause</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-354"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; Text -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; [Text] -&gt; m (Either Text Bool)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">store
-&gt; Context
-&gt; HashSet Text
-&gt; Either Text Bool
-&gt; Text
-&gt; m (Either Text Bool)
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
store
-&gt; Context
-&gt; HashSet Text
-&gt; Either Text Bool
-&gt; Text
-&gt; m (Either Text Bool)
</span><a href="LaunchDarkly.Server.Evaluate.html#checkSegment"><span class="hs-identifier hs-var">checkSegment</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673725"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673723"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673722"><span class="hs-identifier hs-var">seenSegments</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679673721"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">m (Either Text Bool)
-&gt; (Either Text Bool -&gt; m (Either Text Bool))
-&gt; m (Either Text Bool)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; (Either Text Bool -&gt; Either Text Bool)
-&gt; Either Text Bool
-&gt; m (Either Text Bool)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Either Text Bool -&gt; Either Text Bool
forall b c a. (b -&gt; c) -&gt; Either a b -&gt; Either a c
</span><span class="hs-identifier hs-var">mapRight</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Clause -&gt; Bool -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#maybeNegate"><span class="hs-identifier hs-var">maybeNegate</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673724"><span class="hs-identifier hs-var">clause</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause -&gt; Context -&gt; Either Text Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#clauseMatchesContextNoSegments"><span class="hs-identifier hs-var">clauseMatchesContextNoSegments</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673724"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673723"><span class="hs-identifier hs-var">context</span></a></span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span id="local-6989586621679674083"><span id="local-6989586621679674084"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#checkSegment"><span class="hs-identifier hs-type">checkSegment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674084"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier hs-type">LaunchDarklyStoreRead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674083"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674084"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674083"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HS.HashSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674084"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-358"></span><span id="checkSegment"><span class="annot"><span class="annottext">checkSegment :: store
-&gt; Context
-&gt; HashSet Text
-&gt; Either Text Bool
-&gt; Text
-&gt; m (Either Text Bool)
</span><a href="LaunchDarkly.Server.Evaluate.html#checkSegment"><span class="hs-identifier hs-var hs-var">checkSegment</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679673718"><span class="annot"><span class="annottext">e :: Text
</span><a href="#local-6989586621679673718"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text Bool
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673718"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-359"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#checkSegment"><span class="hs-identifier hs-var">checkSegment</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-360"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#checkSegment"><span class="hs-identifier hs-var">checkSegment</span></a></span><span> </span><span id="local-6989586621679673717"><span class="annot"><span class="annottext">store :: store
</span><a href="#local-6989586621679673717"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span id="local-6989586621679673716"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673716"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673715"><span class="annot"><span class="annottext">seenSegments :: HashSet Text
</span><a href="#local-6989586621679673715"><span class="hs-identifier hs-var">seenSegments</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679673714"><span class="annot"><span class="annottext">value :: Text
</span><a href="#local-6989586621679673714"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-361"></span><span>    </span><span class="annot"><span class="annottext">store -&gt; Text -&gt; StoreResultM m (Maybe Segment)
forall store (m :: * -&gt; *).
LaunchDarklyStoreRead store m =&gt;
store -&gt; Text -&gt; StoreResultM m (Maybe Segment)
</span><a href="LaunchDarkly.Server.Store.Internal.html#getSegmentC"><span class="hs-identifier hs-var">getSegmentC</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673717"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673714"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">StoreResultM m (Maybe Segment)
-&gt; (Either Text (Maybe Segment) -&gt; m (Either Text Bool))
-&gt; m (Either Text Bool)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-362"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673713"><span class="annot"><span class="annottext">segment :: Segment
</span><a href="#local-6989586621679673713"><span class="hs-identifier hs-var">segment</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">store -&gt; Segment -&gt; Context -&gt; HashSet Text -&gt; m (Either Text Bool)
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
store -&gt; Segment -&gt; Context -&gt; HashSet Text -&gt; m (Either Text Bool)
</span><a href="LaunchDarkly.Server.Evaluate.html#segmentContainsContext"><span class="hs-identifier hs-var">segmentContainsContext</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673717"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">Segment
</span><a href="#local-6989586621679673713"><span class="hs-identifier hs-var">segment</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673716"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673715"><span class="hs-identifier hs-var">seenSegments</span></a></span><span>
</span><span id="line-363"></span><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="hs-comment">-- Segment ---------------------------------------------------------------------</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span id="local-6989586621679674059"><span id="local-6989586621679674060"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#segmentRuleMatchesContext"><span class="hs-identifier hs-type">segmentRuleMatchesContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674060"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier hs-type">LaunchDarklyStoreRead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674059"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674060"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674059"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#SegmentRule"><span class="hs-identifier hs-type">SegmentRule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HS.HashSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674060"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-368"></span><span id="segmentRuleMatchesContext"><span class="annot"><span class="annottext">segmentRuleMatchesContext :: store
-&gt; SegmentRule
-&gt; Context
-&gt; Text
-&gt; Text
-&gt; HashSet Text
-&gt; m (Either Text Bool)
</span><a href="LaunchDarkly.Server.Evaluate.html#segmentRuleMatchesContext"><span class="hs-identifier hs-var hs-var">segmentRuleMatchesContext</span></a></span></span><span> </span><span id="local-6989586621679673710"><span class="annot"><span class="annottext">store :: store
</span><a href="#local-6989586621679673710"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span id="local-6989586621679673709"><span class="annot"><span class="annottext">rule :: SegmentRule
</span><a href="#local-6989586621679673709"><span class="hs-identifier hs-var">rule</span></a></span></span><span> </span><span id="local-6989586621679673708"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673708"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673707"><span class="annot"><span class="annottext">key :: Text
</span><a href="#local-6989586621679673707"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span id="local-6989586621679673706"><span class="annot"><span class="annottext">salt :: Text
</span><a href="#local-6989586621679673706"><span class="hs-identifier hs-var">salt</span></a></span></span><span> </span><span id="local-6989586621679673705"><span class="annot"><span class="annottext">seenSegments :: HashSet Text
</span><a href="#local-6989586621679673705"><span class="hs-identifier hs-var">seenSegments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; Clause -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; [Clause] -&gt; m (Either Text Bool)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">store -&gt; Either Text Bool -&gt; Clause -&gt; m (Either Text Bool)
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
store -&gt; Either Text Bool -&gt; Clause -&gt; m (Either Text Bool)
</span><a href="#local-6989586621679673704"><span class="hs-identifier hs-var">checkClause</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673710"><span class="hs-identifier hs-var">store</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SegmentRule -&gt; [Clause]
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;clauses&quot;</span></span><span> </span><span class="annot"><span class="annottext">SegmentRule
</span><a href="#local-6989586621679673709"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Either Text Bool)
-&gt; (Either Text Bool -&gt; m (Either Text Bool))
-&gt; m (Either Text Bool)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679673703"><span class="annot"><span class="annottext">result :: Either Text Bool
</span><a href="#local-6989586621679673703"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-370"></span><span>        </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Text Bool
</span><a href="#local-6989586621679673703"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-371"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Text Bool
</span><a href="#local-6989586621679673703"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-372"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Text Bool
</span><a href="#local-6989586621679673703"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-373"></span><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-374"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Either Text Bool) -&gt; Bool -&gt; Either Text Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-375"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">((Float -&gt; Bool) -&gt; Maybe Float -&gt; Bool)
-&gt; Maybe Float -&gt; (Float -&gt; Bool) -&gt; Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; (Float -&gt; Bool) -&gt; Maybe Float -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SegmentRule -&gt; Maybe Float
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;weight&quot;</span></span><span> </span><span class="annot"><span class="annottext">SegmentRule
</span><a href="#local-6989586621679673709"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Float -&gt; Bool) -&gt; Bool) -&gt; (Float -&gt; Bool) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679673702"><span class="annot"><span class="annottext">weight :: Float
</span><a href="#local-6989586621679673702"><span class="hs-identifier hs-var">weight</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-376"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679673701"><span class="annot"><span class="annottext">bucket :: Maybe Float
</span><a href="#local-6989586621679673701"><span class="hs-identifier hs-var hs-var">bucket</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; Maybe Text -&gt; Text -&gt; Text -&gt; Text -&gt; Maybe Int -&gt; Maybe Float
</span><a href="LaunchDarkly.Server.Evaluate.html#bucketContext"><span class="hs-identifier hs-var">bucketContext</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673708"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SegmentRule -&gt; Maybe Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;rolloutContextKind&quot;</span></span><span> </span><span class="annot"><span class="annottext">SegmentRule
</span><a href="#local-6989586621679673709"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673707"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Text
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;key&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SegmentRule -&gt; Maybe Text
forall (f :: Symbol) a s. HasField' f s a =&gt; s -&gt; a
</span><span class="hs-identifier hs-var">getField</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;bucketBy&quot;</span></span><span> </span><span class="annot"><span class="annottext">SegmentRule
</span><a href="#local-6989586621679673709"><span class="hs-identifier hs-var">rule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673706"><span class="hs-identifier hs-var">salt</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-377"></span><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Float
</span><a href="#local-6989586621679673701"><span class="hs-identifier hs-var">bucket</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-378"></span><span>                                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673700"><span class="annot"><span class="annottext">v :: Float
</span><a href="#local-6989586621679673700"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679673700"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679673702"><span class="hs-identifier hs-var">weight</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="hs-number">100000.0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-379"></span><span>                                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-380"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-382"></span><span>    </span><span id="local-6989586621679674070"><span id="local-6989586621679674071"><span class="annot"><a href="#local-6989586621679673704"><span class="hs-identifier hs-type">checkClause</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674071"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier hs-type">LaunchDarklyStoreRead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674070"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674071"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674070"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Clause"><span class="hs-identifier hs-type">Clause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674071"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-383"></span><span>    </span><span id="local-6989586621679673704"><span class="annot"><span class="annottext">checkClause :: store -&gt; Either Text Bool -&gt; Clause -&gt; m (Either Text Bool)
</span><a href="#local-6989586621679673704"><span class="hs-identifier hs-var hs-var">checkClause</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679673699"><span class="annot"><span class="annottext">e :: Text
</span><a href="#local-6989586621679673699"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text Bool
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673699"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><a href="#local-6989586621679673704"><span class="hs-identifier hs-var">checkClause</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><a href="#local-6989586621679673704"><span class="hs-identifier hs-var">checkClause</span></a></span><span> </span><span id="local-6989586621679673698"><span class="annot"><span class="annottext">store :: store
</span><a href="#local-6989586621679673698"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679673697"><span class="annot"><span class="annottext">clause :: Clause
</span><a href="#local-6989586621679673697"><span class="hs-identifier hs-var">clause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">store -&gt; Clause -&gt; Context -&gt; HashSet Text -&gt; m (Either Text Bool)
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
store -&gt; Clause -&gt; Context -&gt; HashSet Text -&gt; m (Either Text Bool)
</span><a href="LaunchDarkly.Server.Evaluate.html#clauseMatchesContext"><span class="hs-identifier hs-var">clauseMatchesContext</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673698"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679673697"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673708"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673705"><span class="hs-identifier hs-var">seenSegments</span></a></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span id="local-6989586621679674075"><span id="local-6989586621679674076"><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#segmentContainsContext"><span class="hs-identifier hs-type">segmentContainsContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674076"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier hs-type">LaunchDarklyStoreRead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674075"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674076"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674075"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HS.HashSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674076"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-388"></span><span id="segmentContainsContext"><span class="annot"><span class="annottext">segmentContainsContext :: store -&gt; Segment -&gt; Context -&gt; HashSet Text -&gt; m (Either Text Bool)
</span><a href="LaunchDarkly.Server.Evaluate.html#segmentContainsContext"><span class="hs-identifier hs-var hs-var">segmentContainsContext</span></a></span></span><span> </span><span id="local-6989586621679673696"><span class="annot"><span class="annottext">store :: store
</span><a href="#local-6989586621679673696"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Features.html#Segment"><span class="hs-identifier hs-type">Segment</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679673694"><span class="annot"><span class="annottext">HashSet Text
$sel:included:Segment :: Segment -&gt; HashSet Text
included :: HashSet Text
</span><a href="LaunchDarkly.Server.Features.html#%24sel%3Aincluded%3ASegment"><span class="hs-identifier hs-var hs-var">included</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673692"><span class="annot"><span class="annottext">[SegmentTarget]
$sel:includedContexts:Segment :: Segment -&gt; [SegmentTarget]
includedContexts :: [SegmentTarget]
</span><a href="LaunchDarkly.Server.Features.html#%24sel%3AincludedContexts%3ASegment"><span class="hs-identifier hs-var hs-var">includedContexts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673690"><span class="annot"><span class="annottext">HashSet Text
$sel:excluded:Segment :: Segment -&gt; HashSet Text
excluded :: HashSet Text
</span><a href="LaunchDarkly.Server.Features.html#%24sel%3Aexcluded%3ASegment"><span class="hs-identifier hs-var hs-var">excluded</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673688"><span class="annot"><span class="annottext">[SegmentTarget]
$sel:excludedContexts:Segment :: Segment -&gt; [SegmentTarget]
excludedContexts :: [SegmentTarget]
</span><a href="LaunchDarkly.Server.Features.html#%24sel%3AexcludedContexts%3ASegment"><span class="hs-identifier hs-var hs-var">excludedContexts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673686"><span class="annot"><span class="annottext">Text
$sel:key:Segment :: Segment -&gt; Text
key :: Text
</span><a href="LaunchDarkly.Server.Features.html#%24sel%3Akey%3ASegment"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673684"><span class="annot"><span class="annottext">Text
$sel:salt:Segment :: Segment -&gt; Text
salt :: Text
</span><a href="LaunchDarkly.Server.Features.html#%24sel%3Asalt%3ASegment"><span class="hs-identifier hs-var hs-var">salt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673682"><span class="annot"><span class="annottext">[SegmentRule]
$sel:rules:Segment :: Segment -&gt; [SegmentRule]
rules :: [SegmentRule]
</span><a href="LaunchDarkly.Server.Features.html#%24sel%3Arules%3ASegment"><span class="hs-identifier hs-var hs-var">rules</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679673680"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673680"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span id="local-6989586621679673679"><span class="annot"><span class="annottext">seenSegments :: HashSet Text
</span><a href="#local-6989586621679673679"><span class="hs-identifier hs-var">seenSegments</span></a></span></span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; HashSet Text -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><span class="hs-identifier hs-var">HS.member</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673686"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673679"><span class="hs-identifier hs-var">seenSegments</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text Bool
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="hs-string">&quot;segment rule caused a circular reference; this is probably a temporary condition&quot;</span></span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HashSet Text -&gt; Text -&gt; Context -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#contextKeyInTargetList"><span class="hs-identifier hs-var">contextKeyInTargetList</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673694"><span class="hs-identifier hs-var">included</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673680"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SegmentTarget -&gt; Bool) -&gt; [SegmentTarget] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SegmentTarget -&gt; Context -&gt; Bool)
-&gt; Context -&gt; SegmentTarget -&gt; Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SegmentTarget -&gt; Context -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#contextKeyInSegmentTarget"><span class="hs-identifier hs-var">contextKeyInSegmentTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673680"><span class="hs-identifier hs-var">context</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SegmentTarget]
</span><a href="#local-6989586621679673692"><span class="hs-identifier hs-var">includedContexts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HashSet Text -&gt; Text -&gt; Context -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#contextKeyInTargetList"><span class="hs-identifier hs-var">contextKeyInTargetList</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673690"><span class="hs-identifier hs-var">excluded</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;user&quot;</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673680"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SegmentTarget -&gt; Bool) -&gt; [SegmentTarget] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SegmentTarget -&gt; Context -&gt; Bool)
-&gt; Context -&gt; SegmentTarget -&gt; Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">SegmentTarget -&gt; Context -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#contextKeyInSegmentTarget"><span class="hs-identifier hs-var">contextKeyInSegmentTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673680"><span class="hs-identifier hs-var">context</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SegmentTarget]
</span><a href="#local-6989586621679673688"><span class="hs-identifier hs-var">excludedContexts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; SegmentRule -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; [SegmentRule] -&gt; m (Either Text Bool)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldlM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">store -&gt; Either Text Bool -&gt; SegmentRule -&gt; m (Either Text Bool)
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
store -&gt; Either Text Bool -&gt; SegmentRule -&gt; m (Either Text Bool)
</span><a href="#local-6989586621679673676"><span class="hs-identifier hs-var">checkRules</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673696"><span class="hs-identifier hs-var">store</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SegmentRule]
</span><a href="#local-6989586621679673682"><span class="hs-identifier hs-var">rules</span></a></span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-396"></span><span>    </span><span id="local-6989586621679674063"><span id="local-6989586621679674064"><span class="annot"><a href="#local-6989586621679673676"><span class="hs-identifier hs-type">checkRules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679674064"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Store.Internal.html#LaunchDarklyStoreRead"><span class="hs-identifier hs-type">LaunchDarklyStoreRead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674063"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679674064"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674063"><span class="hs-identifier hs-type">store</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#SegmentRule"><span class="hs-identifier hs-type">SegmentRule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679674064"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621679673676"><span class="annot"><span class="annottext">checkRules :: store -&gt; Either Text Bool -&gt; SegmentRule -&gt; m (Either Text Bool)
</span><a href="#local-6989586621679673676"><span class="hs-identifier hs-var hs-var">checkRules</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679673675"><span class="annot"><span class="annottext">e :: Text
</span><a href="#local-6989586621679673675"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text Bool
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673675"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-398"></span><span>    </span><span class="annot"><a href="#local-6989586621679673676"><span class="hs-identifier hs-var">checkRules</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Bool -&gt; m (Either Text Bool)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Text Bool -&gt; m (Either Text Bool))
-&gt; Either Text Bool -&gt; m (Either Text Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Either Text Bool
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><a href="#local-6989586621679673676"><span class="hs-identifier hs-var">checkRules</span></a></span><span> </span><span id="local-6989586621679673674"><span class="annot"><span class="annottext">store :: store
</span><a href="#local-6989586621679673674"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679673673"><span class="annot"><span class="annottext">rule :: SegmentRule
</span><a href="#local-6989586621679673673"><span class="hs-identifier hs-var">rule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">store
-&gt; SegmentRule
-&gt; Context
-&gt; Text
-&gt; Text
-&gt; HashSet Text
-&gt; m (Either Text Bool)
forall (m :: * -&gt; *) store.
(Monad m, LaunchDarklyStoreRead store m) =&gt;
store
-&gt; SegmentRule
-&gt; Context
-&gt; Text
-&gt; Text
-&gt; HashSet Text
-&gt; m (Either Text Bool)
</span><a href="LaunchDarkly.Server.Evaluate.html#segmentRuleMatchesContext"><span class="hs-identifier hs-var">segmentRuleMatchesContext</span></a></span><span> </span><span class="annot"><span class="annottext">store
</span><a href="#local-6989586621679673674"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">SegmentRule
</span><a href="#local-6989586621679673673"><span class="hs-identifier hs-var">rule</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673680"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673686"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673684"><span class="hs-identifier hs-var">salt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; HashSet Text -&gt; HashSet Text
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.insert</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673686"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673679"><span class="hs-identifier hs-var">seenSegments</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#contextKeyInSegmentTarget"><span class="hs-identifier hs-type">contextKeyInSegmentTarget</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Features.html#SegmentTarget"><span class="hs-identifier hs-type">SegmentTarget</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-402"></span><span id="contextKeyInSegmentTarget"><span class="annot"><span class="annottext">contextKeyInSegmentTarget :: SegmentTarget -&gt; Context -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#contextKeyInSegmentTarget"><span class="hs-identifier hs-var hs-var">contextKeyInSegmentTarget</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="LaunchDarkly.Server.Features.html#SegmentTarget"><span class="hs-identifier hs-type">SegmentTarget</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679673671"><span class="annot"><span class="annottext">HashSet Text
$sel:values:SegmentTarget :: SegmentTarget -&gt; HashSet Text
values :: HashSet Text
</span><a href="LaunchDarkly.Server.Features.html#%24sel%3Avalues%3ASegmentTarget"><span class="hs-identifier hs-var hs-var">values</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679673669"><span class="annot"><span class="annottext">Text
$sel:contextKind:SegmentTarget :: SegmentTarget -&gt; Text
contextKind :: Text
</span><a href="LaunchDarkly.Server.Features.html#%24sel%3AcontextKind%3ASegmentTarget"><span class="hs-identifier hs-var hs-var">contextKind</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet Text -&gt; Text -&gt; Context -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#contextKeyInTargetList"><span class="hs-identifier hs-var">contextKeyInTargetList</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673671"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673669"><span class="hs-identifier hs-var">contextKind</span></a></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="annot"><a href="LaunchDarkly.Server.Evaluate.html#contextKeyInTargetList"><span class="hs-identifier hs-type">contextKeyInTargetList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="LaunchDarkly.Server.Context.Internal.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-405"></span><span id="contextKeyInTargetList"><span class="annot"><span class="annottext">contextKeyInTargetList :: HashSet Text -&gt; Text -&gt; Context -&gt; Bool
</span><a href="LaunchDarkly.Server.Evaluate.html#contextKeyInTargetList"><span class="hs-identifier hs-var hs-var">contextKeyInTargetList</span></a></span></span><span> </span><span id="local-6989586621679673667"><span class="annot"><span class="annottext">targets :: HashSet Text
</span><a href="#local-6989586621679673667"><span class="hs-identifier hs-var">targets</span></a></span></span><span> </span><span id="local-6989586621679673666"><span class="annot"><span class="annottext">kind :: Text
</span><a href="#local-6989586621679673666"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621679673665"><span class="annot"><span class="annottext">context :: Context
</span><a href="#local-6989586621679673665"><span class="hs-identifier hs-var">context</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Context -&gt; Maybe Context
</span><a href="LaunchDarkly.Server.Context.html#getIndividualContext"><span class="hs-identifier hs-var">getIndividualContext</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679673666"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673665"><span class="hs-identifier hs-var">context</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679673664"><span class="annot"><span class="annottext">ctx :: Context
</span><a href="#local-6989586621679673664"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; HashSet Text -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">elem</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; Text
</span><a href="LaunchDarkly.Server.Context.Internal.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679673664"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashSet Text
</span><a href="#local-6989586621679673667"><span class="hs-identifier hs-var">targets</span></a></span><span>
</span><span id="line-407"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-408"></span></pre></body></html>